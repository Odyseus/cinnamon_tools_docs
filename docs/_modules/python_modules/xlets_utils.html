<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>python_modules.xlets_utils &mdash; Cinnamon Tools  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/cinnamon-logo.svg"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: False" >
            <a href="../../index.html" class="icon icon-home"> Cinnamon Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../includes/00-requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/01-usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/02-theme.html">Themes development/building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/03-tips-and-tricks.html">Cinnamon tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/04-development-notes.html">Development notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/05-code-styling.html">Code styling/guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/06-EOL.html"><abbr title="end-of-life">EOL</abbr> ideas/plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/07-xlets-settings-custom-framework.html">Xlets settings custom framework</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: False" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cinnamon Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>python_modules.xlets_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for python_modules.xlets_utils</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Module with utility functions and classes.</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">root_folder : str</span>
<span class="sd">    The main folder containing the application. All commands must be executed from this location</span>
<span class="sd">    without exceptions.</span>
<span class="sd">validate_options_1 : method</span>
<span class="sd">    Function to validate numeric input.</span>
<span class="sd">validate_options_1_2 : method</span>
<span class="sd">    Function to validate numeric input.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copy2</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copytree</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">ignore_patterns</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">rmtree</span>

<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">cmd_utils</span>
<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">file_utils</span>
<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">misc_utils</span>
<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">prompts</span>
<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">string_utils</span>
<span class="kn">from</span> <span class="nn">.python_utils</span> <span class="kn">import</span> <span class="n">yaml_utils</span>
<span class="kn">from</span> <span class="nn">.python_utils.simple_validators</span> <span class="kn">import</span> <span class="n">generate_numeral_options_validator</span>
<span class="kn">from</span> <span class="nn">.python_utils.simple_validators</span> <span class="kn">import</span> <span class="n">validate_output_path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">app_data</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">app_utils</span>

<span class="n">root_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="o">*</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))))</span>
<span class="n">validate_options_1</span> <span class="o">=</span> <span class="n">generate_numeral_options_validator</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">validate_options_1_2</span> <span class="o">=</span> <span class="n">generate_numeral_options_validator</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="XletsHelperCore"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore">[docs]</a><span class="k">class</span> <span class="nc">XletsHelperCore</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Xlets core functions.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    all_xlets_meta : list</span>
<span class="sd">        All xlets meta data.</span>
<span class="sd">    logger : LogSystem</span>
<span class="sd">        The logger.</span>
<span class="sd">    xlets_display_names : list</span>
<span class="sd">        The complete list of xlets as returned by :any:`get_xlets_display_names`.</span>
<span class="sd">    xlets_meta : dict</span>
<span class="sd">        The metadata of all xlets in this repository.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlets_display_names</span><span class="o">=</span><span class="p">[],</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlets_display_names : list, optional</span>
<span class="sd">            The complete list of xlets as returned by :any:`get_xlets_display_names`.</span>
<span class="sd">        logger : LogSystem</span>
<span class="sd">            The logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlets_display_names</span> <span class="o">=</span> <span class="n">xlets_display_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_xlets_meta</span> <span class="o">=</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">AllXletsMetadata</span><span class="p">()</span><span class="o">.</span><span class="n">meta_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_store_xlets_meta</span><span class="p">()</span>

<div class="viewcode-block" id="XletsHelperCore._store_xlets_meta"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore._store_xlets_meta">[docs]</a>    <span class="k">def</span> <span class="nf">_store_xlets_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set xlets metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_display_names</span><span class="p">:</span>
            <span class="n">xlets_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_display_names</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_xlets_meta</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">xlets_filter</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_xlets_meta</span></div>

<div class="viewcode-block" id="XletsHelperCore.generate_meta_file"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.generate_meta_file">[docs]</a>    <span class="k">def</span> <span class="nf">generate_meta_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :any:`app_utils.generate_meta_file`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_xlets_meta</span> <span class="o">=</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">generate_meta_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_store_xlets_meta</span><span class="p">()</span></div>

<div class="viewcode-block" id="XletsHelperCore.check_js_modules"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.check_js_modules">[docs]</a>    <span class="k">def</span> <span class="nf">check_js_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check JavaScript modules.</span>

<span class="sd">        This function checks if a JS module defined in an xlet configuration file is actually</span>
<span class="sd">        used/imported by an xlet. It also checks if an xlet used/imported by an xlet is actually</span>
<span class="sd">        defined in an xlet configuration file.</span>

<span class="sd">        TODO</span>
<span class="sd">        ----</span>
<span class="sd">        Deal with JS files inside an xlet folder that might not need to be checked. For example,</span>
<span class="sd">        JS files belonging to HTML assets don&#39;t need to be checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Checking xlets JavaScript modules...**&quot;</span><span class="p">)</span>

        <span class="n">all_js_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;js_modules&quot;</span><span class="p">])</span>
                          <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Checking JavaScript modules for </span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">...**&#39;</span><span class="p">)</span>

            <span class="n">js_files_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">xlet_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
                    <span class="n">extra_settings</span> <span class="o">=</span> <span class="n">yaml_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;javascript_modules&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extra_settings</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.js&quot;</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="n">js_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">js_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">js_file</span><span class="p">:</span>
                        <span class="n">js_files_data</span><span class="p">[</span><span class="n">js_file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">js_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">not_used_modules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">not_defined_modules</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">js_module</span> <span class="ow">in</span> <span class="n">extra_settings</span><span class="p">[</span><span class="s2">&quot;javascript_modules&quot;</span><span class="p">]:</span>
                <span class="n">js_module_used</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">js_file_path</span><span class="p">,</span> <span class="n">js_file_content</span> <span class="ow">in</span> <span class="n">js_files_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">js_module_used</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">js_module_used</span> <span class="o">=</span> <span class="n">js_module</span> <span class="ow">in</span> <span class="n">js_file_content</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">js_module_used</span><span class="p">:</span>
                    <span class="n">not_used_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">js_module</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">js_module</span> <span class="ow">in</span> <span class="n">all_js_modules</span><span class="p">:</span>
                <span class="n">js_module_used</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">js_file_path</span><span class="p">,</span> <span class="n">js_file_content</span> <span class="ow">in</span> <span class="n">js_files_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">js_module_used</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">js_module_used</span> <span class="o">=</span> <span class="n">js_module</span> <span class="ow">in</span> <span class="n">js_file_content</span>

                <span class="k">if</span> <span class="n">js_module_used</span> <span class="ow">and</span> <span class="n">js_module</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extra_settings</span><span class="p">[</span><span class="s2">&quot;javascript_modules&quot;</span><span class="p">]:</span>
                    <span class="n">not_defined_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">js_module</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">not_used_modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;**Found JavaScript modules defined in config.yaml but not used:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">**&quot;</span> <span class="o">%</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">not_used_modules</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">not_defined_modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;**Found JavaScript modules used but not defined in config.yaml:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">**&quot;</span> <span class="o">%</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">not_defined_modules</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">not_used_modules</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">not_defined_modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**No anomalies were found.**&quot;</span><span class="p">)</span>

            <span class="n">js_files_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="XletsHelperCore.create_xlets_changelogs"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.create_xlets_changelogs">[docs]</a>    <span class="k">def</span> <span class="nf">create_xlets_changelogs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create xlets change logs.</span>

<span class="sd">        Generate the CHANGELOG.md files for all xlets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Generating xlets change logs...**&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Generating change log for </span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">...**&#39;</span><span class="p">)</span>

            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">CHANGELOG_HEADER_XLETS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">xlet_name</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">repo_url</span><span class="o">=</span><span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
                <span class="p">))</span>

            <span class="c1"># Generate change log from current repository paths.</span>
            <span class="n">relative_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">s/</span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">GIT_LOG_CMD_XLETS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">xlet_slug</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">],</span>
                <span class="n">relative_path</span><span class="o">=</span><span class="n">relative_path</span><span class="p">,</span>
                <span class="n">append_or_override</span><span class="o">=</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span>
                <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">,</span>
                <span class="n">repo_url</span><span class="o">=</span><span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">root_folder</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_store_error</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">],</span>
                                  <span class="s2">&quot;create_xlets_changelogs&quot;</span><span class="p">,</span>
                                  <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="XletsHelperCore.update_pot_files"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.update_pot_files">[docs]</a>    <span class="k">def</span> <span class="nf">update_pot_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update POT files.</span>

<span class="sd">        Update all .pot files from all xlets.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the make-cinnamon-xlet-pot-cli command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Starting POT files update...**&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">additional_files_to_scan</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># NOTE: See app_data.py &gt; LOCALIZED_STRINGS</span>
                <span class="s2">&quot;--scan-additional-file=../../__app__/python_modules/app_data.py&quot;</span>
            <span class="p">]</span>
            <span class="n">extra_paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">extra_settings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">xlet_pot_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;po&quot;</span><span class="p">,</span> <span class="s2">&quot;{{UUID}}.pot&quot;</span><span class="p">)</span>
            <span class="n">xlet_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
            <span class="n">create_localized_help_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;create_localized_help.py&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
                    <span class="n">extra_settings</span> <span class="o">=</span> <span class="n">yaml_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

                <span class="n">extra_paths</span> <span class="o">=</span> <span class="n">extra_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;make_pot_additional_files&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">additional_files_to_scan</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;--scan-additional-file=</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">extra_paths</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">src_dir_name</span> <span class="ow">in</span> <span class="n">app_data</span><span class="o">.</span><span class="n">XLET_MODULES_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">modules</span> <span class="o">=</span> <span class="n">extra_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src_dir_name</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">src_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">src_dir_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">modules</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
                        <span class="n">mod_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_dir_path</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">mod_path</span><span class="p">):</span>
                            <span class="n">additional_files_to_scan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s1">&#39;--scan-additional-file=</span><span class="si">{</span><span class="n">mod_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;../..&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="n">mod_path</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">mod_path</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                                    <span class="c1"># Only deal with a limited set of file extensions.</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.js&quot;</span><span class="p">)):</span>
                                        <span class="k">continue</span>
                                    <span class="n">additional_files_to_scan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="s2">&quot;--scan-additional-file=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;../..&quot;</span><span class="p">)</span>
                                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">create_localized_help_file</span><span class="p">):</span>
                <span class="n">additional_files_to_scan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;--scan-additional-file=../../__app__/python_modules/localized_help_creator.py&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Updating localization template for </span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">...**&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;make-cinnamon-xlet-pot-cli&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;**MissingCommand:** make-cinnamon-xlet-pot-cli command not found!!!&quot;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;make-cinnamon-xlet-pot-cli&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--custom-header&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;--output=</span><span class="si">{</span><span class="n">xlet_pot_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s2">&quot;--ignored-pattern=__data__/__000__*&quot;</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">additional_files_to_scan</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">xlet_root_folder</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_store_error</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">],</span>
                                  <span class="s2">&quot;update_pot_files&quot;</span><span class="p">,</span>
                                  <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="XletsHelperCore.create_localized_help"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.create_localized_help">[docs]</a>    <span class="k">def</span> <span class="nf">create_localized_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create localized help.</span>

<span class="sd">        Execute the create_localized_help.py script for each xlet to generate their</span>
<span class="sd">        HELP.html files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Starting localized help creation...**&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">script_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;create_localized_help.py&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_file_path</span><span class="p">):</span>
                <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Creating localized help for </span><span class="si">{</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">...**&#39;</span><span class="p">)</span>
                <span class="c1"># NOTE: Passing sys.executable ensures that the create_localized_help.py script</span>
                <span class="c1"># is executed with the same interpreter that the main applications is executed with.</span>
                <span class="n">po</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">script_file_path</span><span class="p">],</span>
                                       <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">xlet_root_folder</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_error</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">],</span>
                                      <span class="s2">&quot;create_localized_help&quot;</span><span class="p">,</span>
                                      <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_repository_readme</span><span class="p">()</span></div>

<div class="viewcode-block" id="XletsHelperCore.update_repository_readme"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.update_repository_readme">[docs]</a>    <span class="k">def</span> <span class="nf">update_repository_readme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update repository README file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Generating repository README.md file...**&quot;</span><span class="p">)</span>
        <span class="n">applets_list_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extensions_list_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_xlets_meta</span><span class="p">:</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">script_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;create_localized_help.py&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_file_path</span><span class="p">):</span>
                <span class="c1"># Store list items for later creating the README.md file.</span>
                <span class="n">list_item</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">README_LIST_ITEM_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">xlet_name</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">xlet_slug</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;applet&quot;</span><span class="p">:</span>
                    <span class="n">applets_list_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
                    <span class="n">extensions_list_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_item</span><span class="p">)</span>

        <span class="n">readme_template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;README.md&quot;</span><span class="p">)</span>
        <span class="n">readme_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;README.md&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme_template_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readme_template</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">readme_template</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readme_file</span><span class="p">:</span>
                <span class="n">readme_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">applets_help_pages</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">applets_list_items</span><span class="p">)),</span>
                    <span class="n">extensions_help_pages</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">extensions_list_items</span><span class="p">)),</span>
                    <span class="n">repo_url</span><span class="o">=</span><span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">],</span>
                    <span class="n">repo_docs_url</span><span class="o">=</span><span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo_docs&quot;</span><span class="p">]</span>
                <span class="p">))</span></div>

<div class="viewcode-block" id="XletsHelperCore.generate_trans_stats"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.generate_trans_stats">[docs]</a>    <span class="k">def</span> <span class="nf">generate_trans_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate translations statistics.</span>

<span class="sd">        Generates files that contain the amount of untranslated strings an xlet has.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the msgmerge command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Generating translation statistics...**&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;msgmerge&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;**MissingCommand:** msgmerge command not found!!!&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">markdown_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">po_tmp_storage</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;po_files_updated&quot;</span><span class="p">)</span>
        <span class="n">trans_stats_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;po_files_untranslated_table.md&quot;</span><span class="p">)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">po_tmp_storage</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">po_tmp_storage</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">xlet_type</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">xlet_slug</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">xlet_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">xlet_slug</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">xlet_po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">root_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span> <span class="n">xlet_slug</span><span class="p">,</span> <span class="s2">&quot;po&quot;</span><span class="p">)</span>
            <span class="n">tmp_xlet_po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">po_tmp_storage</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">xlet_slug</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tmp_xlet_po_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">):</span>
                <span class="n">xlet_po_list</span> <span class="o">=</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">recursive_glob</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">,</span> <span class="s2">&quot;*.po&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">xlet_po_list</span><span class="p">:</span>
                    <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**</span><span class="si">{</span><span class="n">xlet_type</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xlet_slug</span><span class="si">}</span><span class="s1">**&#39;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">markdown_content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;### </span><span class="si">{</span><span class="n">xlet_type</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xlet_slug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;|LANGUAGE|UNTRANSLATED|&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;|--------|------------|&quot;</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>

                    <span class="k">for</span> <span class="n">po_file_path</span> <span class="ow">in</span> <span class="n">xlet_po_list</span><span class="p">:</span>
                        <span class="n">po_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">po_file_path</span><span class="p">)</span>
                        <span class="n">tmp_po_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_xlet_po_dir</span><span class="p">,</span> <span class="n">po_base_name</span><span class="p">)</span>
                        <span class="n">tmp_pot_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">,</span> <span class="s2">&quot;{{UUID}}.pot&quot;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Copying </span><span class="si">{</span><span class="n">po_base_name</span><span class="si">}</span><span class="s1"> to temporary location...**&#39;</span><span class="p">,</span>
                                         <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">copy2</span><span class="p">(</span><span class="n">po_file_path</span><span class="p">,</span> <span class="n">tmp_po_file_path</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Updating temporary </span><span class="si">{</span><span class="n">po_base_name</span><span class="si">}</span><span class="s1"> from localization template...**&#39;</span><span class="p">,</span>
                                         <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">po</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">([</span>
                            <span class="s2">&quot;msgmerge&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;--silent&quot;</span><span class="p">,</span>             <span class="c1"># Shut the heck up.</span>
                            <span class="s2">&quot;--no-wrap&quot;</span><span class="p">,</span>            <span class="c1"># Do not wrap long lines.</span>
                            <span class="s2">&quot;--no-fuzzy-matching&quot;</span><span class="p">,</span>  <span class="c1"># Do not use fuzzy matching.</span>
                            <span class="s2">&quot;--backup=off&quot;</span><span class="p">,</span>         <span class="c1"># Never make backups.</span>
                            <span class="s2">&quot;--update&quot;</span><span class="p">,</span>             <span class="c1"># Update .po file, do nothing if up to date.</span>
                            <span class="n">tmp_po_file_path</span><span class="p">,</span>       <span class="c1"># The .po file to update.</span>
                            <span class="n">tmp_pot_file_path</span>       <span class="c1"># The template file to update from.</span>
                        <span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_store_error</span><span class="p">(</span><span class="n">xlet_slug</span><span class="p">,</span>
                                              <span class="sa">f</span><span class="s2">&quot;update_spanish_localizations </span><span class="si">{</span><span class="n">po_base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                              <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Counting untranslated strings...**&quot;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">trans_count_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;msggrep -v -T -e &quot;.&quot; &quot;</span><span class="si">{</span><span class="n">tmp_po_file_path</span><span class="si">}</span><span class="s1">&quot; | grep -c ^msgstr&#39;</span>
                        <span class="n">trans_count_output</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">trans_count_cmd</span><span class="p">,</span>
                                                               <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
                        <span class="n">trans_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trans_count_output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">markdown_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|</span><span class="si">%s</span><span class="s2">|</span><span class="si">%d</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">po_base_name</span><span class="p">,</span> <span class="n">trans_count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">trans_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">trans_count</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">markdown_content</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">trans_stats_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trans_file</span><span class="p">:</span>
                <span class="n">trans_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">markdown_content</span><span class="p">))</span></div>

<div class="viewcode-block" id="XletsHelperCore.update_spanish_localizations"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.update_spanish_localizations">[docs]</a>    <span class="k">def</span> <span class="nf">update_spanish_localizations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update Spanish localizations.</span>

<span class="sd">        Update all Spanish localizations from all xlets.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the msgmerge command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Updating Spanish localizations...**&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;msgmerge&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;**MissingCommand:** msgmerge command not found!!!&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="p">:</span>
            <span class="n">xlet_type</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">xlet_slug</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">xlet_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">xlet_slug</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span> <span class="n">xlet_slug</span><span class="p">,</span> <span class="s2">&quot;po&quot;</span><span class="p">)</span>
            <span class="n">po_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">po_dir</span><span class="p">,</span> <span class="s2">&quot;es.po&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">po_file</span><span class="p">):</span>
                <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Updating localization for </span><span class="si">{</span><span class="n">xlet_slug</span><span class="si">}</span><span class="s1">**&#39;</span><span class="p">)</span>

                <span class="n">po</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">([</span>
                    <span class="s2">&quot;msgmerge&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--silent&quot;</span><span class="p">,</span>                 <span class="c1"># Shut the heck up.</span>
                    <span class="s2">&quot;--no-wrap&quot;</span><span class="p">,</span>                <span class="c1"># Do not wrap long lines.</span>
                    <span class="s2">&quot;--no-fuzzy-matching&quot;</span><span class="p">,</span>      <span class="c1"># Do not use fuzzy matching.</span>
                    <span class="s2">&quot;--backup=off&quot;</span><span class="p">,</span>             <span class="c1"># Never make backups.</span>
                    <span class="s2">&quot;--update&quot;</span><span class="p">,</span>                 <span class="c1"># Update .po file, do nothing if up to date.</span>
                    <span class="s2">&quot;es.po&quot;</span><span class="p">,</span>                    <span class="c1"># The .po file to update.</span>
                    <span class="s2">&quot;{{UUID}}.pot&quot;</span>              <span class="c1"># The template file to update from.</span>
                <span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">po_dir</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_error</span><span class="p">(</span><span class="n">xlet_slug</span><span class="p">,</span>
                                      <span class="s2">&quot;update_spanish_localizations:msgmerge&quot;</span><span class="p">,</span>
                                      <span class="n">po</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">))</span></div>

                <span class="c1"># NOTE: Keep me just in case.</span>
                <span class="c1"># po = cmd_utils.run_cmd([</span>
                <span class="c1">#     &quot;msgattrib&quot;,</span>
                <span class="c1">#     &quot;--no-wrap&quot;,                # Do not wrap long line.</span>
                <span class="c1">#     &quot;--no-obsolete&quot;,            # Remove unused translations.</span>
                <span class="c1">#     &quot;--output-file=es.po&quot;,      # Overrwrite original file.</span>
                <span class="c1">#     &quot;es.po&quot;                     # The .po file to update.</span>
                <span class="c1"># ], stdout=None, cwd=po_dir)</span>

                <span class="c1"># if po.stderr:</span>
                <span class="c1">#     self._store_error(xlet_slug,</span>
                <span class="c1">#                       &quot;update_spanish_localizations:msgattrib&quot;,</span>
                <span class="c1">#                       po.stderr.decode(&quot;UTF-8&quot;))</span>

<div class="viewcode-block" id="XletsHelperCore._store_error"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore._store_error">[docs]</a>    <span class="k">def</span> <span class="nf">_store_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlet_slug</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store error for later logging.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlet_slug : str</span>
<span class="sd">            Xlet slug.</span>
<span class="sd">        function_name : str</span>
<span class="sd">            The name of the function that raised the error.</span>
<span class="sd">        error : str</span>
<span class="sd">            The error message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xlet_slug</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">][</span><span class="n">function_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">][</span><span class="n">function_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletsHelperCore.log_errors"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletsHelperCore.log_errors">[docs]</a>    <span class="k">def</span> <span class="nf">log_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log all stored errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">xlet_slug</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**</span><span class="si">{</span><span class="n">xlet_slug</span><span class="si">}</span><span class="s1">**&#39;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">]:</span>
                <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">xlet_slug</span><span class="p">][</span><span class="n">function_name</span><span class="p">]:</span>
                    <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="build_xlets"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.build_xlets">[docs]</a><span class="k">def</span> <span class="nf">build_xlets</span><span class="p">(</span><span class="n">xlets_display_names</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">domain_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">build_output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">do_not_confirm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">install_localizations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">extra_files</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">from_menu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build xlets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xlets_display_names : list, optional</span>
<span class="sd">        The list of xlets to build.</span>
<span class="sd">    domain_name : None, optional</span>
<span class="sd">        The domain name to use to build the xlets.</span>
<span class="sd">    build_output : str, optional</span>
<span class="sd">        Path to the folder were the built xlets are stored.</span>
<span class="sd">    do_not_confirm : bool, optional</span>
<span class="sd">        Whether to ask for overwrite confirmation when an xlet destination exists or not.</span>
<span class="sd">    install_localizations : bool, optional</span>
<span class="sd">        Whether or not to install xlet localizations.</span>
<span class="sd">    extra_files : str, optional</span>
<span class="sd">        Path to a folder containing files that will be copied into an xlet folder at build time.</span>
<span class="sd">    logger : LogSystem</span>
<span class="sd">        The logger.</span>
<span class="sd">    from_menu : bool, optional</span>
<span class="sd">        Whether this function was called from the CLI menu or not.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    SystemExit</span>
<span class="sd">        Halt execution if the domain name cannot be obtained.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: o_m_l_v a.k.a. options_map_latest_used_values</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_latest_build_data_file&quot;</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">o_m_l_v</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">o_m_l_v</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_name</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;domain_storage_file&quot;</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">domain_file</span><span class="p">:</span>
                <span class="n">domain_name</span> <span class="o">=</span> <span class="n">domain_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">domain_name</span> <span class="o">=</span> <span class="s2">&quot;domain.com&quot;</span>

    <span class="n">options_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;install_localizations&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s2">&quot;do_not_confirm&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">options_map_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;domain_name&quot;</span><span class="p">:</span> <span class="n">domain_name</span><span class="p">,</span>
        <span class="c1"># Note: Check needed to avoid storing None.</span>
        <span class="s2">&quot;build_output&quot;</span><span class="p">:</span> <span class="n">build_output</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;install_localizations&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span> <span class="k">if</span> <span class="n">install_localizations</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra_files&quot;</span><span class="p">:</span> <span class="n">extra_files</span><span class="p">,</span>
        <span class="s2">&quot;do_not_confirm&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span> <span class="k">if</span> <span class="n">do_not_confirm</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span>
    <span class="p">}</span>

    <span class="n">interactive</span> <span class="o">=</span> <span class="n">from_menu</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="ow">and</span> <span class="n">o_m_l_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">options_map_defaults</span> <span class="o">!=</span> <span class="n">o_m_l_v</span><span class="p">:</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Build data from a previous xlet build found at:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**</span><span class="si">{</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_latest_build_data_file&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">**&#39;</span><span class="p">,</span>
                    <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Details:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">XLETS_BUILD_DATA</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">domain_name</span><span class="o">=</span><span class="n">o_m_l_v</span><span class="p">[</span><span class="s2">&quot;domain_name&quot;</span><span class="p">],</span>
            <span class="n">build_output</span><span class="o">=</span><span class="n">o_m_l_v</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">],</span>
            <span class="n">do_not_confirm</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="ow">not</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">][</span><span class="n">o_m_l_v</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">]]),</span>
            <span class="n">install_localizations</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span>
                <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;install_localizations&quot;</span><span class="p">][</span><span class="n">o_m_l_v</span><span class="p">[</span><span class="s2">&quot;install_localizations&quot;</span><span class="p">]]),</span>
            <span class="n">extra_files</span><span class="o">=</span><span class="n">o_m_l_v</span><span class="p">[</span><span class="s2">&quot;extra_files&quot;</span><span class="p">],</span>
        <span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Choose an option:&quot;</span><span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;**1.** Use data interactively.&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;**2.** Use data and directly build xlets.&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;**Press any other key to not use stored data.**&quot;</span><span class="p">)</span>

        <span class="n">answer</span> <span class="o">=</span> <span class="n">prompts</span><span class="o">.</span><span class="n">read_char</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

        <span class="c1"># Do not change defaults if one chooses not to use stored build data.</span>
        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="ow">or</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span>
            <span class="c1"># Check that the stored options contain all options needed for the building process.</span>
            <span class="c1"># If not, add them.</span>
            <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">options_map_defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">opt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">o_m_l_v</span><span class="p">:</span>
                    <span class="n">o_m_l_v</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="c1"># Check that the stored options doesn&#39;t contain options that aren&#39;t used anymore.</span>
            <span class="c1"># If they do, remove them.</span>
            <span class="n">new_o_m_l_v</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">o_m_l_v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">options_map_defaults</span><span class="p">:</span>
                    <span class="n">new_o_m_l_v</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_m_l_v</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>

            <span class="n">options_map_defaults</span> <span class="o">=</span> <span class="n">new_o_m_l_v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">interactive</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s2">&quot;2&quot;</span>

    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="c1"># Ask for domain name.</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Choose a domain name:&quot;</span><span class="p">)</span>
        <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span>
                          <span class="s2">&quot;domain_name&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;Enter name&quot;</span><span class="p">,</span>
                          <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;domain_name&quot;</span><span class="p">])</span>

        <span class="c1"># Ask for build output.</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">([</span><span class="s2">&quot;Where to store built xlets?&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;Choose an option:&quot;</span><span class="p">])</span>
        <span class="n">question</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;**1.** Temporary location.&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;**2.** Install into user home.&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;**Press any other key to specify a location.**&quot;</span><span class="p">)</span>

        <span class="n">answer</span> <span class="o">=</span> <span class="n">prompts</span><span class="o">.</span><span class="n">read_char</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="n">ask_for_confirmation_options</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s2">&quot;1&quot;</span>

        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">app_utils</span><span class="o">.</span><span class="n">get_base_temp_folder</span><span class="p">(),</span>
                <span class="n">misc_utils</span><span class="o">.</span><span class="n">micro_to_milli</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_date_time</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span>
            <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_install_location&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ask for output directory.</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Choose a storage location:&quot;</span><span class="p">)</span>
            <span class="c1"># NOTE: Yes, if the previous build_output was the temporary location,</span>
            <span class="c1"># inform that it will be overwritten with a new temporary location.</span>
            <span class="c1"># This is to avoid dealing with existing xlets built into /tmp.</span>
            <span class="k">if</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">app_utils</span><span class="o">.</span><span class="n">get_base_temp_folder</span><span class="p">()):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;The following default value, if chosen, will be re-generated and overwritten.&quot;</span><span class="p">,</span>
                    <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span>
                              <span class="s2">&quot;build_output&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Enter a path&quot;</span><span class="p">,</span>
                              <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">],</span>
                              <span class="n">validator</span><span class="o">=</span><span class="n">validate_output_path</span><span class="p">)</span>

        <span class="c1"># NOTE: Yes, check again (just in case) if build_output is inside /tmp.</span>
        <span class="c1"># So I can cancel asking for confirmation options since there is no</span>
        <span class="c1"># need to ask for confirmation options when the possibility of</span>
        <span class="c1"># overwriting an existing xlet is null.</span>
        <span class="k">if</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">app_utils</span><span class="o">.</span><span class="n">get_base_temp_folder</span><span class="p">()):</span>
            <span class="n">ask_for_confirmation_options</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>

        <span class="k">if</span> <span class="n">ask_for_confirmation_options</span><span class="p">:</span>
            <span class="c1"># Ask for overwrite confirmation.</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">([</span><span class="s2">&quot;Choose what to do when a built xlet already exists at the destination.&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;1. Confirm each overwrite operation&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;2. Directly overwrite existent xlets&quot;</span><span class="p">])</span>
            <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span>
                              <span class="s2">&quot;do_not_confirm&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Enter option&quot;</span><span class="p">,</span>
                              <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">],</span>
                              <span class="n">validator</span><span class="o">=</span><span class="n">validate_options_1_2</span><span class="p">)</span>

        <span class="c1"># NOTE: Do not ask to install localizations if the output location</span>
        <span class="c1"># is not Cinnamon&#39;s install location for xlets.</span>
        <span class="k">if</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                <span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_install_location&quot;</span><span class="p">]):</span>
            <span class="c1"># Ask for localizations installation.</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">([</span><span class="s2">&quot;Choose if you want to install xlets localizations.&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;1. Do not install xlets localizations&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;2. Install xlets localizations&quot;</span><span class="p">])</span>
            <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span>
                              <span class="s2">&quot;install_localizations&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Enter option&quot;</span><span class="p">,</span>
                              <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;install_localizations&quot;</span><span class="p">],</span>
                              <span class="n">validator</span><span class="o">=</span><span class="n">validate_options_1_2</span><span class="p">)</span>

        <span class="c1"># Ask for extra files location.</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span>
            <span class="s2">&quot;Choose a location containing extra files to be copied into the built xlets folders.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Read the documentation to learn how this option works.&quot;</span><span class="p">,</span>
                       <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Choose an option:&quot;</span><span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;**1.** Specify location.&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;**Press any other key to ignore and reset this option.**&quot;</span><span class="p">)</span>

        <span class="n">answer</span> <span class="o">=</span> <span class="n">prompts</span><span class="o">.</span><span class="n">read_char</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;Choose extra files location:&quot;</span><span class="p">)</span>
            <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span>
                              <span class="s2">&quot;extra_files&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Enter location&quot;</span><span class="p">,</span>
                              <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;extra_files&quot;</span><span class="p">],</span>
                              <span class="n">validator</span><span class="o">=</span><span class="n">validate_output_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;extra_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># TODO: Implement a &quot;domain name validator&quot; function.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;domain_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">MISSING_THEME_OR_DOMAIN_NAME_MSG</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">capital</span><span class="o">=</span><span class="s2">&quot;Domain&quot;</span><span class="p">,</span>
                                                                        <span class="n">lower</span><span class="o">=</span><span class="s2">&quot;domain&quot;</span><span class="p">,</span>
                                                                        <span class="n">types</span><span class="o">=</span><span class="s2">&quot;xlets&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">app_utils</span><span class="o">.</span><span class="n">get_base_temp_folder</span><span class="p">())</span> <span class="ow">or</span> \
            <span class="ow">not</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]:</span>
        <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">get_base_temp_folder</span><span class="p">(),</span>
            <span class="n">misc_utils</span><span class="o">.</span><span class="n">micro_to_milli</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">get_date_time</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="n">xlets_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xlets_display_names</span><span class="p">:</span>
        <span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">xlet_type</span> <span class="o">=</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">xlet_source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlet_type</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span> <span class="n">xlet_dir_name</span><span class="p">)</span>
        <span class="n">xlet_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_source</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xlet_config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
                <span class="n">xlet_config</span> <span class="o">=</span> <span class="n">yaml_utils</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlet_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">uuid</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlet_dir_name</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;domain_name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">xlets_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">xlet_type</span><span class="p">,</span>
            <span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="n">xlet_dir_name</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">xlet_config</span><span class="p">,</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">xlet_source</span><span class="p">,</span>
            <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">file_utils</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]),</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">xlet_type</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span>
                <span class="n">uuid</span>
            <span class="p">)</span>
        <span class="p">})</span>

    <span class="n">do_not_confirm</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">][</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;do_not_confirm&quot;</span><span class="p">]]</span>
    <span class="n">install_localizations</span> <span class="o">=</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;install_localizations&quot;</span><span class="p">][</span>
        <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;install_localizations&quot;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">xlets_data</span><span class="p">:</span>
        <span class="n">built_xlets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">xlets_data</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">XletBuilder</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">do_not_confirm</span><span class="o">=</span><span class="n">do_not_confirm</span><span class="p">,</span>
                <span class="n">install_localizations</span><span class="o">=</span><span class="n">install_localizations</span><span class="p">,</span>
                <span class="n">extra_files</span><span class="o">=</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;extra_files&quot;</span><span class="p">],</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
            <span class="p">)</span>
            <span class="n">built</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">built</span><span class="p">:</span>
                <span class="n">built_xlets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlets_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">built_xlets</span><span class="p">):</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The build process of some xlets was canceled or there was an error while building them.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Check the logs for more details.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Built xlets saved at:**</span><span class="se">\n</span><span class="si">{</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;build_output&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_latest_build_data_file&quot;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="XletBuilder"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder">[docs]</a><span class="k">class</span> <span class="nc">XletBuilder</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;XletBuilder class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    logger : LogSystem</span>
<span class="sd">        The logger.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlet_data</span><span class="p">,</span>
                 <span class="n">do_not_confirm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">install_localizations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">extra_files</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlet_data : dict</span>
<span class="sd">            The xlet data to handle.</span>
<span class="sd">        do_not_confirm : bool</span>
<span class="sd">            Whether to ask for overwrite confirmation when an xlet destination exists or not.</span>
<span class="sd">        install_localizations : bool, optional</span>
<span class="sd">            Whether or not to install xlet localizations.</span>
<span class="sd">        extra_files : str, optional</span>
<span class="sd">            Path to a folder containing files that will be copied into an xlet folder at build time.</span>
<span class="sd">        logger : LogSystem</span>
<span class="sd">            The logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span> <span class="o">=</span> <span class="n">xlet_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_not_confirm</span> <span class="o">=</span> <span class="n">do_not_confirm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_install_localizations</span> <span class="o">=</span> <span class="n">install_localizations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_files</span> <span class="o">=</span> <span class="n">extra_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_cinnamon_version_override</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_cinnamon_version_override</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="s2">&quot;schemas&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="XletBuilder.build"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build xlet.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the xlet was built or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_utils</span><span class="o">.</span><span class="n">print_separator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Building the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">**&#39;</span><span class="p">)</span>

        <span class="c1"># NOTE: If the copy operation was canceled, do not proceed with the building process.</span>
        <span class="n">proceed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">proceed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_config_data</span><span class="p">()</span>

            <span class="n">string_utils</span><span class="o">.</span><span class="n">do_string_substitutions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_replacement_data</span><span class="p">(),</span>
                <span class="n">allowed_extensions</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.bash&quot;</span><span class="p">,</span> <span class="s2">&quot;.js&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.pot&quot;</span><span class="p">),</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_modify_metadata</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_schemas</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_extra_files</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_executable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_install_po_files</span><span class="p">()</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="XletBuilder._get_replacement_data"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._get_replacement_data">[docs]</a>    <span class="k">def</span> <span class="nf">_get_replacement_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get replacement data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list of replacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;{{UUID}}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;{{REPO_URL}}&quot;</span><span class="p">,</span> <span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;{{XLET_TYPE}}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PYTHON_SHEBANGS</span><span class="p">[</span><span class="s2">&quot;dev&quot;</span><span class="p">],</span> <span class="n">app_data</span><span class="o">.</span><span class="n">PYTHON_SHEBANGS</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="XletBuilder._do_copy"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._do_copy">[docs]</a>    <span class="k">def</span> <span class="nf">_do_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy xlet files into its final destination.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Do not raise inside this function. Return True or False so other instances</span>
<span class="sd">        of this class can continue operating. For example, if one is building several</span>
<span class="sd">        xlets and decides not to overwrite one of them, just continue building the rest</span>
<span class="sd">        of the xlets.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt build operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Destination exists and is a file!!! Aborted!!!&quot;</span><span class="p">,</span>
                                <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_not_confirm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">EXISTENT_XLET_DESTINATION_MSG</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_not_confirm</span> <span class="ow">or</span> <span class="n">prompts</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Building the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> was canceled.&#39;</span><span class="p">,</span>
                    <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Copying main xlet files...**&quot;</span><span class="p">)</span>

        <span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ignore</span><span class="o">=</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="o">*</span><span class="n">app_data</span><span class="o">.</span><span class="n">XLET_DIR_IGNORED_PATTERNS</span><span class="p">),</span>
                 <span class="n">ignore_dangling_symlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Copying common xlet files...**&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">app_data</span><span class="o">.</span><span class="n">EXTRA_COMMON_FILES</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;source_path&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">])</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;destination_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">extra</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depends_on&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_to_check</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;depends_on&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_to_check</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>

            <span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="XletBuilder._handle_config_data"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._handle_config_data">[docs]</a>    <span class="k">def</span> <span class="nf">_handle_config_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle xlet configuration file if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">config_data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">src_dir_name</span><span class="p">,</span> <span class="n">dst_dir_name</span> <span class="ow">in</span> <span class="n">app_data</span><span class="o">.</span><span class="n">XLET_MODULES_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src_dir_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Copying </span><span class="si">{</span><span class="n">src_dir_name</span><span class="si">}</span><span class="s1"> files...**&#39;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src_dir_name</span><span class="p">):</span>
                        <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">src_dir_name</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
                        <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">dst_dir_name</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file_or_folder</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_files&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Copying extra files...**&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_files&quot;</span><span class="p">):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">])</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_file_or_folder</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Generating symbolic links...**&quot;</span><span class="p">)</span>

                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">])</span>

                <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">):</span>
                    <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="nb">dir</span><span class="p">)</span>

                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">)[</span><span class="nb">dir</span><span class="p">]:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>

                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">root_folder</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_cinnamon_version_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Minimum Cinnamon version override found...**&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_min_cinnamon_version_override</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;min_cinnamon_version_override&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_cinnamon_version_override&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Maximum Cinnamon version override found...**&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_cinnamon_version_override</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;max_cinnamon_version_override&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._copy_file_or_folder"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._copy_file_or_folder">[docs]</a>    <span class="k">def</span> <span class="nf">_copy_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy file or folder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        src : str</span>
<span class="sd">            Source path.</span>
<span class="sd">        dst : str</span>
<span class="sd">            Destination path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">file_utils</span><span class="o">.</span><span class="n">custom_copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">file_utils</span><span class="o">.</span><span class="n">custom_copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._modify_metadata"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._modify_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">_modify_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modify metadata.json file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Modifying xlet metadata...**&quot;</span><span class="p">)</span>
        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="s2">&quot;metadata.json&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">old</span><span class="p">:</span>
            <span class="n">xlet_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="n">supported_versions</span> <span class="o">=</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">supported_cinnamon_versions_range</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_min_cinnamon_version_override</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_cinnamon_version_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">app_data</span><span class="o">.</span><span class="n">SUPPORTED_CINNAMON_VERSION_MIN</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_cinnamon_version_override</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_cinnamon_version_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">app_data</span><span class="o">.</span><span class="n">SUPPORTED_CINNAMON_VERSION_MAX</span>
        <span class="p">)</span>

        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;cinnamon-version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">supported_versions</span>
        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span>
        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;website&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">URLS</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;contributors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">LOCALIZED_STRINGS</span><span class="p">[</span><span class="s2">&quot;metadata-contributors&quot;</span><span class="p">]</span>
        <span class="n">xlet_metadata</span><span class="p">[</span><span class="s2">&quot;comments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">LOCALIZED_STRINGS</span><span class="p">[</span><span class="s2">&quot;metadata-comments&quot;</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">xlet_metadata</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._compile_schemas"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._compile_schemas">[docs]</a>    <span class="k">def</span> <span class="nf">_compile_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compile schema files if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schemas_dir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Compiling gsettings schema...**&quot;</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;glib-compile-schemas&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;--targetdir=.&quot;</span><span class="p">]</span>

            <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_schemas_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._copy_extra_files"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._copy_extra_files">[docs]</a>    <span class="k">def</span> <span class="nf">_copy_extra_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy extra files.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_files</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">extra_files_for_xlet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_files</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_dir</span><span class="p">(</span><span class="n">extra_files_for_xlet</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Copying extra files into built xlet folder:**&quot;</span><span class="p">)</span>

        <span class="n">ignored_patterns</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">XLET_DIR_IGNORED_PATTERNS</span> <span class="o">+</span> <span class="n">app_data</span><span class="o">.</span><span class="n">XLET_EXTRA_FILES_IGNORED_PATTERNS</span>
        <span class="n">file_utils</span><span class="o">.</span><span class="n">custom_copytree</span><span class="p">(</span><span class="n">extra_files_for_xlet</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span>
                                   <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                                   <span class="n">log_copied_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">ignored_patterns</span><span class="o">=</span><span class="n">ignored_patterns</span><span class="p">,</span>
                                   <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._set_executable"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._set_executable">[docs]</a>    <span class="k">def</span> <span class="nf">_set_executable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set files as executable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Setting execution permissions to the following files:**&quot;</span><span class="p">)</span>
        <span class="n">existent_files_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files_list</span> <span class="o">=</span> <span class="n">app_data</span><span class="o">.</span><span class="n">XLET_EXEC_FILES</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;set_executable&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">files_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_list</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_utils</span><span class="o">.</span><span class="n">is_real_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="n">existent_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existent_files_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">existent_files_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="mo">0o755</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._install_po_files"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.XletBuilder._install_po_files">[docs]</a>    <span class="k">def</span> <span class="nf">_install_po_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Install xlets .po files.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_install_localizations</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">app_data</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s2">&quot;xlets_install_location&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;**Localizations can only be installed when the xlets are built into Cinnamon&#39;s install location for xlets.**&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Installing xlet localizations:**&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd_str</span> <span class="o">=</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;make-cinnamon-xlet-pot-cli&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cmd_utils</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;cinnamon-xlet-makepot&quot;</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd_str</span><span class="si">}</span><span class="s2"> -i&quot;</span>

            <span class="n">cmd_utils</span><span class="o">.</span><span class="n">run_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span>
                              <span class="n">stdout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">stderr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="get_xlets_display_names"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.get_xlets_display_names">[docs]</a><span class="k">def</span> <span class="nf">get_xlets_display_names</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get xlets dirs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        The list of xlets directory names prefixed with their &quot;types&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">applets_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Applet </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">list_xlets_dirs</span><span class="p">(</span><span class="s2">&quot;applets&quot;</span><span class="p">)]</span>
    <span class="n">extensions_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Extension </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">list_xlets_dirs</span><span class="p">(</span><span class="s2">&quot;extensions&quot;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">applets_dirs</span> <span class="o">+</span> <span class="n">extensions_dirs</span></div>


<div class="viewcode-block" id="BaseXletGenerator"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.BaseXletGenerator">[docs]</a><span class="k">class</span> <span class="nc">BaseXletGenerator</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Base xlet generator.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    base_xlet_path : str</span>
<span class="sd">        Path to the base application (the template).</span>
<span class="sd">    logger : LogSystem</span>
<span class="sd">        The logger.</span>
<span class="sd">    new_xlet_destination : str</span>
<span class="sd">        The path to the new generated application.</span>
<span class="sd">    xlet_data : dict</span>
<span class="sd">        Storage for xlet data that will be used to generate a base xlet.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        logger : LogSystem</span>
<span class="sd">            The logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="BaseXletGenerator.generate"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.BaseXletGenerator.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_copy</span><span class="p">()</span>
        <span class="n">string_utils</span><span class="o">.</span><span class="n">do_string_substitutions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_replacement_data</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseXletGenerator._do_setup"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.BaseXletGenerator._do_setup">[docs]</a>    <span class="k">def</span> <span class="nf">_do_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do setup.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the destination exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;My Custom Xlet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;My custom xlet description.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_instances&quot;</span><span class="p">:</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">prompt_data_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;applet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;__data__/config.yaml&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;__data__/create_localized_help.py&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;applet.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;js_modules/constants.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;js_modules/utils.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata.json&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;settings-schema.json&quot;</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;extension&quot;</span><span class="p">,</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;__data__/config.yaml&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;__data__/create_localized_help.py&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;extension.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;js_modules/constants.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;js_modules/utils.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata.json&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter an xlet type:</span><span class="se">\n\n</span><span class="s2">1. applet</span><span class="se">\n</span><span class="s2">2. extension&quot;</span><span class="p">)</span>
        <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Choose an option&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data_map</span><span class="p">[</span><span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter a name for the xlet:&quot;</span><span class="p">)</span>
        <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter name&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="c1"># Define these here so I can check for existent destination immediately after the</span>
        <span class="c1"># xlet name is defined and exit if it already exists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">part</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                                          <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_xlet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;BaseXlet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span>
                                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;**ExistentLocation:** New xlet cannot be created.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter a description for the xlet:&quot;</span><span class="p">)</span>
        <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;Enter description&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
            <span class="n">app_utils</span><span class="o">.</span><span class="n">inform</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter max instances for the xlet:&quot;</span><span class="p">)</span>
            <span class="n">prompts</span><span class="o">.</span><span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;max_instances&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Enter max. instances&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data_map</span><span class="p">[</span><span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="s2">&quot;files&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type_title_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_replacement_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_NAME$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_DESCRIPTION$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_TYPE$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_TYPE_TITLE_CASE$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type_title_case&quot;</span><span class="p">]),</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="BaseXletGenerator._do_copy"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.BaseXletGenerator._do_copy">[docs]</a>    <span class="k">def</span> <span class="nf">_do_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;**Copying files...**&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>
            <span class="n">file_utils</span><span class="o">.</span><span class="n">custom_copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_xlet_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                                    <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="print_xlets_slugs"><a class="viewcode-back" href="../../modules/python_modules/python_modules.xlets_utils.html#python_modules.xlets_utils.print_xlets_slugs">[docs]</a><span class="k">def</span> <span class="nf">print_xlets_slugs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Print xlets slugs.</span>

<span class="sd">    This method is called by the Bash completions script to auto-complete</span>
<span class="sd">    xlets slugs for the ``--xlet-name=`` and ``-x`` CLI options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">xlet_dir_name</span> <span class="ow">in</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">list_xlets_dirs</span><span class="p">(</span>
            <span class="s2">&quot;applets&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">app_utils</span><span class="o">.</span><span class="n">list_xlets_dirs</span><span class="p">(</span><span class="s2">&quot;extensions&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">xlet_dir_name</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Odyseus..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://gitlab.com/Odyseus/sphinx_rtd_theme_mod">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>

        </div>
      </div>

      <a id="to-top-of-page" href="#top">
        <i class="fa fa-chevron-circle-up"></i>
      </a>

    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>