<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>xlets_settings &mdash; Cinnamon Tools  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/cinnamon-logo.svg"/>
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: False" >
            <a href="../index.html" class="icon icon-home"> Cinnamon Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../includes/00-requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/01-usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/02-theme.html">Themes development/building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/03-tips-and-tricks.html">Cinnamon tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/04-development-notes.html">Development notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/05-code-styling.html">Code styling/guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/06-EOL.html"><abbr title="end-of-life">EOL</abbr> ideas/plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includes/07-xlets-settings-custom-framework.html">Xlets settings custom framework</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: False" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cinnamon Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>xlets_settings</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for xlets_settings</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Cinnamon&#39;s xlets settings re-implementation.</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">G_SETTINGS_WIDGETS : dict</span>
<span class="sd">    gsettings widgets map.</span>
<span class="sd">MAIN_APP : MainApplication</span>
<span class="sd">    An instance of :any:`MainApplication`.</span>
<span class="sd">MODULE_PATH : str</span>
<span class="sd">    Path to the root of this module.</span>
<span class="sd">proxy : Gio.DBusProxy</span>
<span class="sd">    A ``Gio.DBusProxy``.</span>
<span class="sd">XLET_SETTINGS_WIDGETS : dict</span>
<span class="sd">    Settings widgets map.</span>

<span class="sd">Deleted Attributes</span>
<span class="sd">------------------</span>
<span class="sd">CINNAMON_VERSION : str</span>
<span class="sd">    Cinnamon version.</span>
<span class="sd">GTK_VERSION : str</span>
<span class="sd">    Gtk version.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">gi</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;Gdk&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;GdkPixbuf&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0&quot;</span><span class="p">)</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;Gtk&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">GLib</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gdk</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">GdkPixbuf</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gio</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gtk</span>
<span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">escape</span>
<span class="c1"># from subprocess import check_output</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">run</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">.GSettingsWidgets</span> <span class="kn">import</span> <span class="o">*</span>                                           <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">.JsonSettingsWidgets</span> <span class="kn">import</span> <span class="o">*</span>                                        <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">.ansi_colors</span> <span class="kn">import</span> <span class="n">Ansi</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">BaseGrid</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">HOME</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">get_global</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">set_global</span>

<span class="n">MODULE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="c1"># NOTE: Commented until they are needed.</span>
<span class="c1"># CINNAMON_VERSION = check_output(</span>
<span class="c1">#     [&quot;cinnamon&quot;, &quot;--version&quot;]</span>
<span class="c1"># ).decode(&quot;utf-8&quot;).splitlines()[0].split(&quot; &quot;)[1]</span>
<span class="c1"># GTK_VERSION = f&quot;{Gtk.get_major_version()}.{Gtk.get_minor_version()}&quot;</span>

<span class="n">proxy</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">MAIN_APP</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">XLET_SETTINGS_WIDGETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;appchooser&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsAppChooser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;applist&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsAppList&quot;</span><span class="p">,</span>
    <span class="s2">&quot;button&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsButton&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: Custom simplified widget.</span>
    <span class="s2">&quot;colorchooser&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsColorChooser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;combobox&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsComboBox&quot;</span><span class="p">,</span>
    <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsEntry&quot;</span><span class="p">,</span>
    <span class="s2">&quot;filechooser&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsFileChooser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iconfilechooser&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsIconChooser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;keybinding&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsKeybinding&quot;</span><span class="p">,</span>
    <span class="s2">&quot;keybinding-with-options&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsKeybindingWithOptions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;list&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsTreeList&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsRange&quot;</span><span class="p">,</span>
    <span class="s2">&quot;soundfilechooser&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsSoundFileChooser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spinbutton&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsSpinButton&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stringslist&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsStringsList&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switch&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsSwitch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;textview&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsTextView&quot;</span><span class="p">,</span>
    <span class="s2">&quot;textviewbutton&quot;</span><span class="p">:</span> <span class="s2">&quot;JSONSettingsTextViewButton&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;datechooser&quot;: &quot;JSONSettingsDateChooser&quot;,</span>
    <span class="c1"># &quot;effect&quot;: &quot;JSONSettingsEffectChooser&quot;,</span>
    <span class="c1"># &quot;fontchooser&quot;: &quot;JSONSettingsFontButton&quot;,</span>
    <span class="c1"># &quot;tween&quot;: &quot;JSONSettingsTweenChooser&quot;,</span>
<span class="p">}</span>

<span class="n">G_SETTINGS_WIDGETS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gcombobox&quot;</span><span class="p">:</span> <span class="s2">&quot;GSettingsComboBox&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gswitch&quot;</span><span class="p">:</span> <span class="s2">&quot;GSettingsSwitch&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;gcolorchooser&quot;: &quot;GSettingsColorChooser&quot;,</span>
    <span class="c1"># &quot;gentry&quot;: &quot;GSettingsEntry&quot;,</span>
    <span class="c1"># &quot;gfilechooser&quot;: &quot;GSettingsFileChooser&quot;,</span>
    <span class="c1"># &quot;giconfilechooser&quot;: &quot;GSettingsIconChooser&quot;,</span>
    <span class="c1"># &quot;gscale&quot;: &quot;GSettingsRange&quot;,</span>
    <span class="c1"># &quot;gsoundfilechooser&quot;: &quot;GSettingsSoundFileChooser&quot;,</span>
    <span class="c1"># &quot;gspinbutton&quot;: &quot;GSettingsSpinButton&quot;,</span>
    <span class="c1"># &quot;gtextview&quot;: &quot;GSettingsTextView&quot;,</span>
<span class="p">}</span>


<div class="viewcode-block" id="SettingsBox"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.SettingsBox">[docs]</a><span class="k">class</span> <span class="nc">SettingsBox</span><span class="p">(</span><span class="n">BaseGrid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Settings box.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    stack : Gtk.Stack</span>
<span class="sd">        A ``Gtk.Stack``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_double_col_span</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;applist&quot;</span><span class="p">,</span>
        <span class="s2">&quot;button&quot;</span><span class="p">,</span>
        <span class="s2">&quot;buttonsgroup&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">_should_fill_row</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;list&quot;</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_definition</span><span class="p">,</span> <span class="n">instance_info</span><span class="o">=</span><span class="p">{},</span> <span class="n">xlet_meta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window_definition : WindowDefinition</span>
<span class="sd">            The instance of :any:`WindowDefinition` containing the data to generate all window widgets.</span>
<span class="sd">        instance_info : dict, optional</span>
<span class="sd">            Xlet instance information.</span>
<span class="sd">        xlet_meta : None, optional</span>
<span class="sd">            Xlet metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_border_width</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_spacing</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># NOTE: Set property to avoid calling 2 methods.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># NOTE: Set property to avoid calling 4 methods.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span> <span class="o">=</span> <span class="n">xlet_meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span> <span class="o">=</span> <span class="n">instance_info</span>

        <span class="n">stack</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">set_transition_type</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">StackTransitionType</span><span class="o">.</span><span class="n">SLIDE_UP_DOWN</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">set_transition_duration</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="c1"># NOTE: Set property to avoid calling 2 methods.</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;expand&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># NOTE: Set property to avoid calling 4 methods.</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">page_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">page_def</span> <span class="ow">in</span> <span class="n">window_definition</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
            <span class="c1"># NOTE: Possibility to hide entire pages depending on a condition defined in</span>
            <span class="c1"># the widgets definition file.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page_def</span><span class="o">.</span><span class="n">compatible</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">page_scrolled_window</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">(</span><span class="n">hadjustment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vadjustment</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">page_scrolled_window</span><span class="o">.</span><span class="n">set_policy</span><span class="p">(</span><span class="n">hscrollbar_policy</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">PolicyType</span><span class="o">.</span><span class="n">NEVER</span><span class="p">,</span>
                                            <span class="n">vscrollbar_policy</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">PolicyType</span><span class="o">.</span><span class="n">AUTOMATIC</span><span class="p">)</span>
            <span class="c1"># Mark for deletion on EOL. Gtk4</span>
            <span class="c1"># Stop using set_shadow_type and set the boolean property has-frame.</span>
            <span class="n">page_scrolled_window</span><span class="o">.</span><span class="n">set_shadow_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ShadowType</span><span class="o">.</span><span class="n">ETCHED_IN</span><span class="p">)</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">SettingsPage</span><span class="p">()</span>  <span class="c1"># noqa | JsonSettingsWidgets &gt; SettingsWidgets</span>
            <span class="n">page_scrolled_window</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

            <span class="n">section_count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">section_def</span> <span class="ow">in</span> <span class="n">page_def</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="c1"># NOTE: Possibility to hide entire sections depending on a condition defined in</span>
                <span class="c1"># the widgets definition file.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">section_def</span><span class="o">.</span><span class="n">compatible</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">section_def</span><span class="o">.</span><span class="n">dependency</span><span class="p">:</span>
                    <span class="n">revealer</span> <span class="o">=</span> <span class="n">JSONSettingsRevealer</span><span class="p">(</span>  <span class="c1"># noqa | JsonSettingsWidgets</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">],</span> <span class="n">section_def</span><span class="o">.</span><span class="n">dependency</span>
                    <span class="p">)</span>
                    <span class="n">section_container</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">add_reveal_section</span><span class="p">(</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                        <span class="n">subtitle</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">subtitle</span><span class="p">,</span>
                        <span class="n">section_info</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                        <span class="n">revealer</span><span class="o">=</span><span class="n">revealer</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">section_container</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                        <span class="n">subtitle</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">subtitle</span><span class="p">,</span>
                        <span class="n">section_info</span><span class="o">=</span><span class="n">section_def</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">section_widgets</span> <span class="o">=</span> <span class="n">section_def</span><span class="o">.</span><span class="n">widgets</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">widget_def</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">section_widgets</span><span class="p">):</span>
                    <span class="c1"># NOTE: Possibility to hide individual widgets depending on a condition defined in</span>
                    <span class="c1"># the widgets definition file.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">compatible</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># NOTE: widget_def is modified by adding an instance of JSONSettingsHandler to it.</span>
                        <span class="c1"># widget_def is stored in widget_def_clean so it can be used by json.dumps() when</span>
                        <span class="c1"># is printed to STDOUT for easy reading. A shallow copy is enough.</span>
                        <span class="n">widget_def_clean</span> <span class="o">=</span> <span class="n">widget_def</span><span class="o">.</span><span class="vm">__dict__</span>
                        <span class="n">widget_type</span> <span class="o">=</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">widget_type</span>
                        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_widget</span><span class="p">(</span><span class="n">widget_def</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="n">MAIN_APP</span><span class="o">.</span><span class="n">errors_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">LIGHT_RED</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">(</span><span class="s2">&quot;**Widget definition**&quot;</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">widget_def_clean</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">widget</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">widget_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_fill_row</span><span class="p">:</span>
                        <span class="n">widget</span><span class="o">.</span><span class="n">fill_row</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">widget</span><span class="o">.</span><span class="n">set_border_width</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                        <span class="n">widget</span><span class="o">.</span><span class="n">set_margin_start</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
                        <span class="n">widget</span><span class="o">.</span><span class="n">set_margin_end</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">widget_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_double_col_span</span><span class="p">:</span>
                        <span class="n">col_span</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">col_span</span> <span class="o">=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="s2">&quot;dependency&quot;</span> <span class="ow">in</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">widget_kwargs</span><span class="p">:</span>
                        <span class="n">revealer</span> <span class="o">=</span> <span class="n">JSONSettingsRevealer</span><span class="p">(</span>  <span class="c1"># noqa | JsonSettingsWidgets</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">],</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">widget_kwargs</span><span class="p">[</span><span class="s2">&quot;dependency&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">section_container</span><span class="o">.</span><span class="n">add_reveal_row</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col_span</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                         <span class="n">revealer</span><span class="o">=</span><span class="n">revealer</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">section_container</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col_span</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">section_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">section_def</span><span class="o">.</span><span class="n">notes</span><span class="p">:</span>
                    <span class="n">section_container</span><span class="o">.</span><span class="n">add_note</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_def</span><span class="o">.</span><span class="n">sections</span><span class="p">)</span> <span class="o">!=</span> <span class="n">section_count</span><span class="p">:</span>
                    <span class="n">section_container</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">))</span>

            <span class="n">page_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">add_titled</span><span class="p">(</span><span class="n">page_scrolled_window</span><span class="p">,</span> <span class="s2">&quot;stack_id_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="n">page_count</span><span class="p">,</span> <span class="n">page_def</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window_definition</span><span class="o">.</span><span class="n">should_create_page_switcher</span><span class="p">():</span>
            <span class="n">page_switcher</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">StackSidebar</span><span class="p">()</span>
            <span class="n">page_switcher</span><span class="o">.</span><span class="n">set_stack</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page_switcher</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;notify::visible-child&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_stack_switcher_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>

<div class="viewcode-block" id="SettingsBox.create_widget"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.SettingsBox.create_widget">[docs]</a>    <span class="k">def</span> <span class="nf">create_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget_def</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create widget.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        widget_def : builder.Widget</span>
<span class="sd">            An instance of :any:`builder.Widget`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SettingsWidgets.SettingsWidget</span>
<span class="sd">            A widget ready to be added to the main application window.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        exceptions.MissingPreferenceKey</span>
<span class="sd">            Inform that a preference key doesn&#39;t exist in the settings-schema.json file.</span>
<span class="sd">        exceptions.UnkownWidgetType</span>
<span class="sd">            Inform that the widget type is non existent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">widget_type</span> <span class="o">=</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">widget_type</span>
        <span class="n">widget_pref_key</span> <span class="o">=</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">pref_key</span>
        <span class="n">widget_kwargs</span> <span class="o">=</span> <span class="n">widget_def</span><span class="o">.</span><span class="n">widget_kwargs</span>

        <span class="k">if</span> <span class="n">widget_type</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="o">**</span><span class="n">widget_kwargs</span><span class="p">)</span>  <span class="c1"># noqa | JsonSettingsWidgets &gt; SettingsWidgets</span>
        <span class="k">elif</span> <span class="n">widget_type</span> <span class="o">==</span> <span class="s2">&quot;buttonsgroup&quot;</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">ButtonsGroup</span><span class="p">()</span>  <span class="c1"># noqa | JsonSettingsWidgets &gt; SettingsWidgets</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">button_def</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">widget_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;buttons&quot;</span><span class="p">,</span> <span class="p">[])):</span>
                <span class="n">button_pref_key</span> <span class="o">=</span> <span class="n">button_def</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">button_kwargs</span> <span class="o">=</span> <span class="n">button_def</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">button_kwargs</span><span class="p">[</span><span class="s2">&quot;for_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">button</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">XLET_SETTINGS_WIDGETS</span><span class="p">[</span><span class="s2">&quot;button&quot;</span><span class="p">]](</span>
                    <span class="n">pref_key</span><span class="o">=</span><span class="n">button_pref_key</span><span class="p">,</span>
                    <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">],</span>
                    <span class="n">widget_kwargs</span><span class="o">=</span><span class="n">button_kwargs</span>
                <span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">widget_type</span> <span class="ow">in</span> <span class="n">XLET_SETTINGS_WIDGETS</span><span class="p">:</span>
            <span class="c1"># NOTE: Doing this check so I can find out at once if there are one or more</span>
            <span class="c1"># missing pref. keys and fix them all at once.</span>
            <span class="k">if</span> <span class="n">widget_pref_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">MissingPreferenceKey</span><span class="p">(</span><span class="n">widget_pref_key</span><span class="p">)</span>

            <span class="n">widget</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">XLET_SETTINGS_WIDGETS</span><span class="p">[</span><span class="n">widget_type</span><span class="p">]](</span>
                <span class="n">pref_key</span><span class="o">=</span><span class="n">widget_pref_key</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_instance_info</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">],</span>
                <span class="n">widget_kwargs</span><span class="o">=</span><span class="n">widget_kwargs</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">widget_type</span> <span class="ow">in</span> <span class="n">G_SETTINGS_WIDGETS</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">G_SETTINGS_WIDGETS</span><span class="p">[</span><span class="n">widget_type</span><span class="p">]](</span>
                <span class="n">pref_key</span><span class="o">=</span><span class="n">widget_pref_key</span><span class="p">,</span>
                <span class="n">schema</span><span class="o">=</span><span class="n">widget_def</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
                <span class="n">xlet_meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="p">,</span>
                <span class="n">widget_kwargs</span><span class="o">=</span><span class="n">widget_kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">UnkownWidgetType</span><span class="p">(</span><span class="n">widget_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">widget</span></div>

<div class="viewcode-block" id="SettingsBox._on_stack_switcher_changed"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.SettingsBox._on_stack_switcher_changed">[docs]</a>    <span class="k">def</span> <span class="nf">_on_stack_switcher_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On stack switcher changed delayed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Remove source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: This bit me in the arse real good!!! LOL</span>
        <span class="c1"># Without the throttle, and connecting only the &quot;notify&quot; signal to the stack, the</span>
        <span class="c1"># on_stack_switcher_changed method was triggered like 5 times and it always stored</span>
        <span class="c1"># the wrong value to MAIN_APP.win_stacks_state.</span>
        <span class="c1"># With the &quot;notify::visible-child&quot; signal connected, on_stack_switcher_changed triggers</span>
        <span class="c1"># automatically only once when the stack is created and the first child is selected,</span>
        <span class="c1"># and immediately again, if needed, to select the child name stored in</span>
        <span class="c1"># MAIN_APP.win_stacks_state. The second call will cancel the first and then store what was</span>
        <span class="c1"># stored (Yeah, I know! ¬¬). Successive changes to the visible children (selecting items</span>
        <span class="c1"># in the sidebar) will trigger on_stack_switcher_changed and store the</span>
        <span class="c1"># correct ID (hopefully).</span>
        <span class="n">MAIN_APP</span><span class="o">.</span><span class="n">store_selected_stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">get_visible_child_name</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">GLib</span><span class="o">.</span><span class="n">SOURCE_REMOVE</span></div>

<div class="viewcode-block" id="SettingsBox.on_stack_switcher_changed"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.SettingsBox.on_stack_switcher_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_stack_switcher_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On stack switcher changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="p">:</span>
            <span class="n">GLib</span><span class="o">.</span><span class="n">source_remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">GLib</span><span class="o">.</span><span class="n">timeout_add</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_stack_switcher_changed</span><span class="p">)</span></div>

<div class="viewcode-block" id="SettingsBox.get_page_stack"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.SettingsBox.get_page_stack">[docs]</a>    <span class="k">def</span> <span class="nf">get_page_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get stack switcher.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Gtk.StackSwitcher</span>
<span class="sd">            The Gtk.StackSwitcher used to switch pages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span></div></div>


<div class="viewcode-block" id="AppMenuButton"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.AppMenuButton">[docs]</a><span class="k">class</span> <span class="nc">AppMenuButton</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MenuButton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Application menu button.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    main_app : MainApplication</span>
<span class="sd">        The main application.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_app</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        main_app : MainApplication</span>
<span class="sd">            The main application.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_icon_name</span><span class="p">(</span>
            <span class="s2">&quot;open-menu-symbolic&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">IconSize</span><span class="o">.</span><span class="n">BUTTON</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span> <span class="o">=</span> <span class="n">main_app</span>

        <span class="n">main_model</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">display_settings_handling</span><span class="p">:</span>
            <span class="n">xlet_settings_model</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">xlet_settings_model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Import settings from a file&quot;</span><span class="p">),</span> <span class="s2">&quot;app.import_settings&quot;</span><span class="p">)</span>
            <span class="n">xlet_settings_model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Export settings to a file&quot;</span><span class="p">),</span> <span class="s2">&quot;app.backup_settings&quot;</span><span class="p">)</span>
            <span class="n">xlet_settings_model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Reset settings to defaults&quot;</span><span class="p">),</span> <span class="s2">&quot;app.reset_settings&quot;</span><span class="p">)</span>
            <span class="n">main_model</span><span class="o">.</span><span class="n">append_section</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Xlet settings&quot;</span><span class="p">),</span> <span class="n">xlet_settings_model</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">xlet_help_file_exists</span><span class="p">:</span>
            <span class="n">xlet_help_model</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
            <span class="n">xlet_help_model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Help&quot;</span><span class="p">),</span> <span class="s2">&quot;app.open_help_page&quot;</span><span class="p">)</span>
            <span class="n">main_model</span><span class="o">.</span><span class="n">append_section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlet_help_model</span><span class="p">)</span>

        <span class="n">app_prefs_model</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">app_prefs_submenu_model</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">app_prefs_submenu_model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Use headerbars on dialogs&quot;</span><span class="p">),</span>
            <span class="s2">&quot;app.use_header_bars_on_dialogs&quot;</span><span class="p">)</span>
        <span class="n">app_prefs_model</span><span class="o">.</span><span class="n">append_submenu</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Application preferences&quot;</span><span class="p">),</span> <span class="n">app_prefs_submenu_model</span><span class="p">)</span>
        <span class="n">main_model</span><span class="o">.</span><span class="n">append_section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">app_prefs_model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_menu_model</span><span class="p">(</span><span class="n">main_model</span><span class="p">)</span></div>


<div class="viewcode-block" id="AppHeaderBar"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.AppHeaderBar">[docs]</a><span class="k">class</span> <span class="nc">AppHeaderBar</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">HeaderBar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Application header bar.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    app_image : Gtk.Button</span>
<span class="sd">        A button with an image to display when there is only one xlet instance to handle.</span>
<span class="sd">    instance_switcher : Gtk.StackSwitcher</span>
<span class="sd">        Instance switcher stack.</span>
<span class="sd">    instance_switcher_box : BaseGrid</span>
<span class="sd">        Instance switcher buttons container.</span>
<span class="sd">    main_app : MainApplication</span>
<span class="sd">        The main application.</span>
<span class="sd">    next_button : Gtk.Button</span>
<span class="sd">        Button to switch to next instance.</span>
<span class="sd">    prev_button : Gtk.Button</span>
<span class="sd">        Button to switch to previous instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_app</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        main_app : MainApplication</span>
<span class="sd">            The main application.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span> <span class="o">=</span> <span class="n">main_app</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_show_close_button</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">StackSwitcher</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span> <span class="o">=</span> <span class="n">BaseGrid</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="c1"># Mark for deletion on EOL. Gtk4</span>
        <span class="c1"># Replace Gtk.StyleContext.add_class with Gtk.Widget.add_css_class.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">()</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STYLE_CLASS_LINKED</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prev_button</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="o">.</span><span class="n">new_from_icon_name</span><span class="p">(</span>
            <span class="s2">&quot;go-previous-symbolic&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">IconSize</span><span class="o">.</span><span class="n">BUTTON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_button</span><span class="o">.</span><span class="n">set_tooltip_text</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Previous instance&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_button</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;clicked&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">previous_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="o">.</span><span class="n">new_from_icon_name</span><span class="p">(</span>
            <span class="s2">&quot;go-next-symbolic&quot;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">IconSize</span><span class="o">.</span><span class="n">BUTTON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">set_tooltip_text</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Next instance&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;clicked&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">next_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="p">)</span>

        <span class="n">res</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">IconSize</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">IconSize</span><span class="o">.</span><span class="n">BUTTON</span><span class="p">)</span>
        <span class="n">pixbuf</span> <span class="o">=</span> <span class="n">GdkPixbuf</span><span class="o">.</span><span class="n">Pixbuf</span><span class="o">.</span><span class="n">new_from_file_at_size</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">xlet_icon_path</span><span class="p">,</span>
            <span class="n">width</span> <span class="k">if</span> <span class="n">res</span> <span class="k">else</span> <span class="mi">16</span><span class="p">,</span>
            <span class="n">height</span> <span class="k">if</span> <span class="n">res</span> <span class="k">else</span> <span class="mi">16</span>
        <span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_pixbuf</span><span class="p">(</span><span class="n">pixbuf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_sensitive</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Mark for deletion on EOL. Gtk4</span>
        <span class="c1"># Stop using set_relief and set the boolean property has-frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_relief</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ReliefStyle</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_can_focus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_receives_default</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_can_default</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Mark for deletion on EOL. Gtk4</span>
        <span class="c1"># Replace Gtk.StyleContext.add_class with Gtk.Widget.add_css_class.</span>
        <span class="c1"># NOTE: Set of a custom class to override the insensitive/disabled styling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">()</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;cinnamon-xlet-settings-app&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">()</span><span class="o">.</span><span class="n">add_class</span><span class="p">(</span><span class="s2">&quot;title-button&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">xlet_help_file_exists</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">display_settings_handling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pack_end</span><span class="p">(</span><span class="n">AppMenuButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_app</span><span class="o">.</span><span class="n">_get_application_title</span><span class="p">())</span></div>


<div class="viewcode-block" id="MainApplication"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication">[docs]</a><span class="k">class</span> <span class="nc">MainApplication</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Application</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main application.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    all_applications_list : list</span>
<span class="sd">        The list of all installed applications on a system.</span>
<span class="sd">    all_instances_info : list</span>
<span class="sd">        Storage for all xlets instances information.</span>
<span class="sd">    application_id : str</span>
<span class="sd">        The application ID.</span>
<span class="sd">    cinnamon_gsettings : Gio.Settings</span>
<span class="sd">        Cinnamon&#39;s gsettings settings (schema ``org.cinnamon``) to get the list of enabled xlets.</span>
<span class="sd">    errors_found : bool</span>
<span class="sd">        Flag to display a notification when non-critical errors are found.</span>
<span class="sd">    gtk_app_info_monitor : Gio.AppInfoMonitor</span>
<span class="sd">        The ``Gio.AppInfoMonitor`` used to monitor system applications changes.</span>
<span class="sd">    gtk_app_info_monitor_signal : int</span>
<span class="sd">        Signal ID for ``self.gtk_app_info_monitor`` connection.</span>
<span class="sd">    gtk_app_info_monitor_uptodate : bool</span>
<span class="sd">        *Flag* used to conditionally force the update of self.all_applications_list.</span>
<span class="sd">    gtk_icon_theme : Gtk.IconTheme</span>
<span class="sd">        This is used to append extra folders to ``Gtk.IconTheme`` to use icons by name instead</span>
<span class="sd">        of by path. It is also used by the :any:`IconChooser` widgets to get the list of icons in an</span>
<span class="sd">        icon theme.</span>
<span class="sd">    gtk_icon_theme_signal : int</span>
<span class="sd">        Signal ID for ``self.gtk_icon_theme`` connection.</span>
<span class="sd">    gtk_icon_theme_uptodate : bool</span>
<span class="sd">        *Flag* used to conditionally force the update of self.icon_chooser_contexts_store.</span>
<span class="sd">    header_bar : Gtk.HeaderBar</span>
<span class="sd">        The header bar used by this application.</span>
<span class="sd">    help_file_path : str</span>
<span class="sd">        Path to an xlet help file.</span>
<span class="sd">    icon_chooser_contexts_store : Gtk.ListStore</span>
<span class="sd">        The place where the icon theme contexts are stored. Each element on this list has two elements.</span>
<span class="sd">        The translated icon context name (for display purposes) at index 0 and the icon context name</span>
<span class="sd">        (used to retrieve from the icon theme all icons from such context) at index 1.</span>
<span class="sd">    icon_chooser_icons_store : Gtk.ListStore</span>
<span class="sd">        The icons database to be used by the :any:`IconChooser` entry.</span>
<span class="sd">    instance_stack : Gtk.Stack</span>
<span class="sd">        The stack where every :any:`SettingsBox` for each xlet instance are added.</span>
<span class="sd">    selected_instance : dict</span>
<span class="sd">        The information of the currently selected instance.</span>
<span class="sd">    win_current_height : int</span>
<span class="sd">        Window current height.</span>
<span class="sd">    win_current_width : int</span>
<span class="sd">        Window current width.</span>
<span class="sd">    win_initial_stack : string</span>
<span class="sd">        Initial stack ID to open the window with this stack selected.</span>
<span class="sd">    win_is_maximized : bool</span>
<span class="sd">        Whether the window is maximized.</span>
<span class="sd">    win_stacks_state : dict</span>
<span class="sd">        The name of each selected stack of each xlet instance.</span>
<span class="sd">    win_state_cache_file : str</span>
<span class="sd">        Path to the file where the window state is stored.</span>
<span class="sd">    window : Gtk.ApplicationWindow</span>
<span class="sd">        The window used by this application.</span>
<span class="sd">    xlet_dir : str</span>
<span class="sd">        Path to where the xlet is installed.</span>
<span class="sd">    xlet_help_file_exists : bool</span>
<span class="sd">        Whether the HELP.html file inside an xlet directory exist.</span>
<span class="sd">    xlet_icon_path : str</span>
<span class="sd">        Path to a file called icon.svg (or icon.png) inside an xlet folder.</span>
<span class="sd">    xlet_instance_id : str</span>
<span class="sd">        Xlet isntance ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_required_args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;window_definition&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xlet_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xlet_uuid&quot;</span>
    <span class="p">}</span>
    <span class="n">_allowed_xlet_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;applet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desklet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extension&quot;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Keyword arguments.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        exceptions.MissingRequiredArgument</span>
<span class="sd">            Halt execution if any of the required arguments weren&#39;t passed.</span>
<span class="sd">        exceptions.WrongType</span>
<span class="sd">            Halt execution if a wrong xlet type was passed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_required_args</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">kwargs_keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">MissingRequiredArgument</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_required_args</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">kwargs_keys</span><span class="p">)))</span>

        <span class="c1"># NOTE: kwargs attributes/CLI parameters.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># NOTE: Default values.</span>
        <span class="c1"># self.application_id = &quot;&quot;</span>
        <span class="c1"># self.display_settings_handling = True</span>
        <span class="c1"># self.debug_mode = False</span>
        <span class="c1"># self.application_title = &quot;&quot;</span>
        <span class="c1"># self.window_definition = None</span>
        <span class="c1"># self.win_initial_height = 600</span>
        <span class="c1"># self.win_initial_width = 800</span>
        <span class="c1"># self.win_initial_stack = &quot;&quot;</span>
        <span class="c1"># self.xlet_instance_id = &quot;&quot;</span>
        <span class="c1"># self.xlet_type = &quot;extension&quot;</span>
        <span class="c1"># self.xlet_uuid = &quot;&quot;</span>
        <span class="c1"># NOTE: Other attributes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/usr/share/cinnamon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="si">}</span><span class="s2">s/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_uptodate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_uptodate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_applications_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_icons_store</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ListStore</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_contexts_store</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ListStore</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cinnamon_gsettings</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Settings</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;org.cinnamon&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">AppInfoMonitor</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s2">&quot;changed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gtk_app_info_monitor_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">IconTheme</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s2">&quot;changed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gtk_icon_theme_changed</span><span class="p">)</span>
        <span class="c1"># NOTE: Append the &quot;icons&quot; folder found in the framework.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">append_search_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MODULE_PATH</span><span class="p">,</span> <span class="s2">&quot;icons&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_xlet_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">WrongType</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_allowed_xlet_types</span><span class="p">),</span>
                                       <span class="n">received</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">application_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;org.Cinnamon.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">s.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.Settings&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span> <span class="o">==</span> <span class="s2">&quot;extension&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_xlet_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">,</span> <span class="s2">&quot;icon.svg&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">,</span> <span class="s2">&quot;icon.png&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">GLib</span><span class="o">.</span><span class="n">set_application_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_application_title</span><span class="p">())</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">application_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application_id</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">Gio</span><span class="o">.</span><span class="n">ApplicationFlags</span><span class="o">.</span><span class="n">FLAGS_NONE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attach_app_actions</span><span class="p">()</span>

<div class="viewcode-block" id="MainApplication.attach_app_actions"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.attach_app_actions">[docs]</a>    <span class="k">def</span> <span class="nf">attach_app_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attach application actions.</span>

<span class="sd">        These actions are mainly triggered from the :any:`AppMenuButton` items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;import_settings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;backup_settings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reset_settings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;open_help_page&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">SimpleAction</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">action_name</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activate&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">SimpleAction</span><span class="o">.</span><span class="n">new_stateful</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;use_header_bars_on_dialogs&quot;</span><span class="p">,</span>
            <span class="n">parameter_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="n">GLib</span><span class="o">.</span><span class="n">Variant</span><span class="o">.</span><span class="n">new_boolean</span><span class="p">(</span><span class="n">get_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;change-state&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toggle_use_header_bars_on_dialogs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication._toggle_use_header_bars_on_dialogs"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._toggle_use_header_bars_on_dialogs">[docs]</a>    <span class="k">def</span> <span class="nf">_toggle_use_header_bars_on_dialogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle USE_HEADER_BARS_ON_DIALOGS setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : Gio.SimpleAction</span>
<span class="sd">            The action whose state changed.</span>
<span class="sd">        value : GLib.Variant</span>
<span class="sd">            Value of the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">set_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">get_boolean</span><span class="p">())</span></div>

<div class="viewcode-block" id="MainApplication.on_gtk_app_info_monitor_changed"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.on_gtk_app_info_monitor_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_gtk_app_info_monitor_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set self.gtk_app_info_monitor_changed to true to force stored applications update.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_uptodate</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MainApplication.on_gtk_icon_theme_changed"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.on_gtk_icon_theme_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_gtk_icon_theme_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set self.gtk_icon_theme_changed to true to force stored icons update.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_uptodate</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MainApplication.init_apps_chooser_data"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.init_apps_chooser_data">[docs]</a>    <span class="k">def</span> <span class="nf">init_apps_chooser_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize applications chooser data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_uptodate</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_applications_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">app_blacklist</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;screensavers-&quot;</span><span class="p">,</span> <span class="s2">&quot;kde4-&quot;</span><span class="p">))</span>

        <span class="c1"># I added this filter because there are more that 200 screen savers in Linux Mint. ¬¬</span>
        <span class="c1"># They were unnecessarily slowing the heck out the loading of the list of applications.</span>
        <span class="c1"># At this point in time, none of the tweaks that makes use of this ApplicationChooserDialog</span>
        <span class="c1"># would require to choose a screen saver from the list, so I happily ignore them for now.</span>
        <span class="k">def</span> <span class="nf">filter_list</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Filter application list.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            x : Gio.DesktopAppInfo</span>
<span class="sd">                The application to filter.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            bool</span>
<span class="sd">                If the application should be included in the list of applications.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">lowered</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get_id</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># I think that is more precise to check the start of the app ID. (?)</span>
            <span class="c1"># The following condition filters out all .desktop files that</span>
            <span class="c1"># are inside a folders called &quot;screensavers&quot; and &quot;kde4&quot;.</span>
            <span class="k">return</span> <span class="n">lowered</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app_blacklist</span> <span class="ow">and</span> <span class="n">lowered</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app_blacklist</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_applications_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_list</span><span class="p">,</span> <span class="n">Gio</span><span class="o">.</span><span class="n">AppInfo</span><span class="o">.</span><span class="n">get_all</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_uptodate</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MainApplication.init_icon_chooser_data"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.init_icon_chooser_data">[docs]</a>    <span class="k">def</span> <span class="nf">init_icon_chooser_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize icon chooser data.</span>

<span class="sd">        This data is generated and stored in :any:`MainApplication` so the</span>
<span class="sd">        tasks aren&#39;t performed for each :any:`IconChooserDialog` created.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_uptodate</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_icons_store</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_contexts_store</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">icon_contexts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">_</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">context</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">list_contexts</span><span class="p">()]</span>
        <span class="n">icon_contexts</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># NOTE: Store absolutely all icons. The ones that are categorized will be removed.</span>
        <span class="c1"># The rest of icons will be displayed in the Other category.</span>
        <span class="n">all_icons_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">list_icons</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">icon_contexts</span><span class="p">:</span>  <span class="c1"># noqa</span>
            <span class="n">icons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">list_icons</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">icon</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">icons</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_icons_store</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">context</span><span class="p">,</span> <span class="n">icon</span><span class="p">])</span>

            <span class="n">all_icons_set</span> <span class="o">=</span> <span class="n">all_icons_set</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">icons</span><span class="p">)</span>

        <span class="n">other_icons</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_icons_set</span><span class="p">)</span>
        <span class="n">other_icons</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">icon</span> <span class="ow">in</span> <span class="n">other_icons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_icons_store</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="p">])</span>

        <span class="n">icon_contexts</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Other&quot;</span><span class="p">),</span> <span class="s2">&quot;other&quot;</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">icon_contexts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">icon_chooser_contexts_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">all_icons_set</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_uptodate</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MainApplication.load_xlet_data"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.load_xlet_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_xlet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load xlet data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/usr/share/cinnamon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="si">}</span><span class="s2">s/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">HOME</span><span class="si">}</span><span class="s2">/.local/share/cinnamon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="si">}</span><span class="s2">s/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">metadata_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="si">}</span><span class="s2">/metadata.json&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">):</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="si">}</span><span class="s2"> metadata for uuid </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s2"> - are you sure it&#39;s installed correctly?&quot;</span><span class="p">)</span>
            <span class="n">quit</span><span class="p">()</span>

        <span class="c1"># NOTE: If exists, append the &quot;icons&quot; folder found in the xlet. Some xlets</span>
        <span class="c1"># settings windows might want to add icons that are shipped with them.</span>
        <span class="c1"># This allows to use the shipped icons by name instead of by their path.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">,</span> <span class="s2">&quot;icons&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span><span class="o">.</span><span class="n">append_search_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">,</span> <span class="s2">&quot;icons&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_dir</span><span class="p">,</span> <span class="s2">&quot;HELP.html&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_help_file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_file_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication.load_instances"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.load_instances">[docs]</a>    <span class="k">def</span> <span class="nf">load_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load xlets instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">HOME</span><span class="si">}</span><span class="s2">/.cinnamon/configs/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">config_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span>
            <span class="n">config_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)])</span>

        <span class="c1"># LOGIC: For extensions it&#39;s always false. For other types, if max-instances metadata.json</span>
        <span class="c1"># property is anyhthong other than 1.</span>
        <span class="n">multi_instance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max-instances&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span> <span class="o">!=</span> <span class="s2">&quot;extension&quot;</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">config_files</span><span class="p">:</span>
            <span class="n">instance_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_instance</span> <span class="ow">and</span> <span class="n">instance_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># for single instance the file name should be [uuid].json</span>

            <span class="k">if</span> <span class="n">multi_instance</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">instance_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># multi-instance should have file names of the form [instance-id].json</span>

                <span class="n">instance_exists</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">enabled_xlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cinnamon_gsettings</span><span class="o">.</span><span class="n">get_strv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;enabled-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">xlet_def</span> <span class="ow">in</span> <span class="n">enabled_xlets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span> <span class="ow">in</span> <span class="n">xlet_def</span> <span class="ow">and</span> <span class="n">instance_id</span> <span class="ow">in</span> <span class="n">xlet_def</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
                        <span class="n">instance_exists</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">instance_exists</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">settings</span> <span class="o">=</span> <span class="n">JSONSettingsHandler</span><span class="p">(</span>  <span class="c1"># noqa | JsonSettingsWidgets</span>
                <span class="n">filepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span>
                <span class="c1"># notify_callback=self.notify_dbus,</span>
                <span class="n">xlet_meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="p">,</span>
                <span class="n">instance_id</span><span class="o">=</span><span class="n">instance_id</span>
            <span class="p">)</span>

            <span class="n">instance_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># A JsonSettingsWidgets instance.</span>
                <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="p">,</span>
                <span class="c1"># The ID of a the selected stack in the side.</span>
                <span class="s2">&quot;stack_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_stacks_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instance_id</span><span class="p">,</span> <span class="s2">&quot;stack_id_1&quot;</span><span class="p">),</span>
                <span class="c1"># The ID (file name without extention) of the xlet instance.</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">instance_id</span><span class="p">,</span>
                <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">,</span>
                <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="n">SettingsStack</span><span class="p">()</span>  <span class="c1"># noqa | JsonSettingsWidgets &gt; SettingsWidgets</span>
            <span class="p">}</span>

            <span class="n">instance_box</span> <span class="o">=</span> <span class="n">SettingsBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_definition</span><span class="p">,</span>
                                       <span class="n">instance_info</span><span class="o">=</span><span class="n">instance_info</span><span class="p">,</span>
                                       <span class="n">xlet_meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">add_named</span><span class="p">(</span><span class="n">instance_box</span><span class="p">,</span> <span class="n">instance_id</span><span class="p">)</span>

            <span class="c1"># LOGIC: If self.xlet_instance_id is set, it was set from the CLI or the xlet is</span>
            <span class="c1"># an extension.</span>
            <span class="c1"># If it isn&#39;t set, the application was called without arguments, either from a terminal</span>
            <span class="c1"># or from one of Cinnamon&#39;s xlet managers.</span>
            <span class="c1"># No need to set self.selected_instance here since it will be set after all</span>
            <span class="c1"># instances are loaded and using the instance with the ID stored in</span>
            <span class="c1"># self.xlet_instance_id.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span> <span class="o">=</span> <span class="n">instance_id</span>

            <span class="n">instances</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">instances</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">set_no_show_all</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">set_no_show_all</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">app_image</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">instance_switcher_box</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.build_window"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.build_window">[docs]</a>    <span class="k">def</span> <span class="nf">build_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ApplicationWindow</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_application_title</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_type_hint</span><span class="p">(</span><span class="n">Gdk</span><span class="o">.</span><span class="n">WindowTypeHint</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">)</span>
        <span class="c1"># NOTE: Always use set_default_size(). Otherwise, when exiting maximized</span>
        <span class="c1"># state, the window will be resized to its minimum size instead of its</span>
        <span class="c1"># previous size.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_current_width</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_current_height</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_height</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_is_maximized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">maximize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">WindowPosition</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_icon_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_icon_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span> <span class="o">=</span> <span class="n">AppHeaderBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">main_box</span> <span class="o">=</span> <span class="n">BaseGrid</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">main_box</span><span class="o">.</span><span class="n">set_spacing</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># NOTE: Set property to avoid calling 4 methods.</span>
        <span class="n">main_box</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
        <span class="n">main_box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">set_titlebar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">main_box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_quit</span><span class="p">)</span>
        <span class="c1"># Mark for deletion on EOL. Gtk4</span>
        <span class="c1"># Stop using size-allocate and window-state-event.</span>
        <span class="c1"># Use property notification for Gtk.Window:default-width and Gtk.Window:default-height.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;size-allocate&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_size_allocate_cb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;window-state-event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_window_state_event_cb</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication._set_win_subtitle"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._set_win_subtitle">[docs]</a>    <span class="k">def</span> <span class="nf">_set_win_subtitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set window subtitle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">set_subtitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">set_subtitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication.load_css"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.load_css">[docs]</a>    <span class="k">def</span> <span class="nf">load_css</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load CSS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">css_provider</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">CssProvider</span><span class="p">()</span>
        <span class="n">css_provider</span><span class="o">.</span><span class="n">load_from_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MODULE_PATH</span><span class="p">,</span> <span class="s2">&quot;stylesheet.css&quot;</span><span class="p">))</span>
        <span class="c1"># css_provider.load_from_data(str.encode(&quot;&quot;&quot;CSS styles&quot;&quot;&quot;))</span>

        <span class="n">screen</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">Screen</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">StyleContext</span><span class="p">()</span>
        <span class="n">context</span><span class="o">.</span><span class="n">add_provider_for_screen</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">css_provider</span><span class="p">,</span>
                                        <span class="n">Gtk</span><span class="o">.</span><span class="n">STYLE_PROVIDER_PRIORITY_USER</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication._get_application_title"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._get_application_title">[docs]</a>    <span class="k">def</span> <span class="nf">_get_application_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get application title.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The application title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_title</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_title</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Settings for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlet_meta</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">title_text</span></div>

<div class="viewcode-block" id="MainApplication._on_proxy_ready"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._on_proxy_ready">[docs]</a>    <span class="k">def</span> <span class="nf">_on_proxy_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define proxy on proxy ready.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Gio.DBusProxy</span>
<span class="sd">            A ``Gio.DBusProxy``.</span>
<span class="sd">        result : Gio.Task</span>
<span class="sd">            A ``Gio.Task``.</span>
<span class="sd">        data : None, optional</span>
<span class="sd">            User data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">proxy</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">DBusProxy</span><span class="o">.</span><span class="n">new_for_bus_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">proxy</span><span class="o">.</span><span class="n">get_name_owner</span><span class="p">():</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">highlightXlet</span><span class="p">(</span><span class="s2">&quot;(ssb)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="MainApplication.do_activate"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.do_activate">[docs]</a>    <span class="k">def</span> <span class="nf">do_activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do activate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">present</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.do_startup"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.do_startup">[docs]</a>    <span class="k">def</span> <span class="nf">do_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do startup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        exceptions.PEBCAK</span>
<span class="sd">            Halt execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_css</span><span class="p">()</span>

        <span class="n">Gtk</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">do_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_window_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_window</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_instances</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">instance_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">instance_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_instance_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_instance</span><span class="p">(</span><span class="n">instance_info</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PEBCAK</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_win_subtitle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>

        <span class="c1"># NOTE: Do not initialize DBus proxy when the xlet type is extension.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span> <span class="o">!=</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Gio</span><span class="o">.</span><span class="n">DBusProxy</span><span class="o">.</span><span class="n">new_for_bus</span><span class="p">(</span><span class="n">Gio</span><span class="o">.</span><span class="n">BusType</span><span class="o">.</span><span class="n">SESSION</span><span class="p">,</span>
                                          <span class="n">Gio</span><span class="o">.</span><span class="n">DBusProxyFlags</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                                          <span class="kc">None</span><span class="p">,</span>
                                          <span class="s2">&quot;org.Cinnamon&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;/org/Cinnamon&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;org.Cinnamon&quot;</span><span class="p">,</span>
                                          <span class="kc">None</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_on_proxy_ready</span><span class="p">,</span>
                                          <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors_found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_errors</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.on_size_allocate_cb"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.on_size_allocate_cb">[docs]</a>    <span class="k">def</span> <span class="nf">on_size_allocate_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save window state and size in size-allocate signal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : Gtk.ApplicationWindow</span>
<span class="sd">            This application window.</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">window</span><span class="o">.</span><span class="n">is_maximized</span><span class="p">():</span>
            <span class="n">win_width</span><span class="p">,</span> <span class="n">win_height</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_current_width</span> <span class="o">=</span> <span class="n">win_width</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_current_height</span> <span class="o">=</span> <span class="n">win_height</span>

        <span class="c1"># NOTE: Using the event.new_window_state &amp; Gdk.WindowState.MAXIMIZED</span>
        <span class="c1"># check in on_window_state_event_cb will not save the maximized state</span>
        <span class="c1"># when maximizing the window and then closing it, unless the window</span>
        <span class="c1"># is first unfocused and refocused.</span>
        <span class="c1"># Are you F*CKING KIDING ME!?!?!?!</span>
        <span class="c1"># SO, save the maximized state EVERY SINGLE F*CKING time size-allocate</span>
        <span class="c1"># is triggered and move the F*CK on!!!!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_is_maximized</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">is_maximized</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.on_window_state_event_cb"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.on_window_state_event_cb">[docs]</a>    <span class="k">def</span> <span class="nf">on_window_state_event_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save window state in window-state-event signal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : Gtk.ApplicationWindow</span>
<span class="sd">            A ``Gtk.ApplicationWindow``.</span>
<span class="sd">        event : Gdk.EventWindowState</span>
<span class="sd">            A ``Gdk.EventWindowState``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">new_window_state</span> <span class="o">&amp;</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">WindowState</span><span class="o">.</span><span class="n">MAXIMIZED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win_is_maximized</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">is_maximized</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.store_selected_stack"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.store_selected_stack">[docs]</a>    <span class="k">def</span> <span class="nf">store_selected_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store selected stack.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stack_id : str</span>
<span class="sd">            The ID of the currently selected sidebar item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_stacks_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">stack_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;stack_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stack_id</span></div>

<div class="viewcode-block" id="MainApplication._store_window_state"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._store_window_state">[docs]</a>    <span class="k">def</span> <span class="nf">_store_window_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store window state to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win_state_cache_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win_state_cache_file</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span>
                    <span class="s2">&quot;use_header_bars_on_dialogs&quot;</span><span class="p">:</span> <span class="n">get_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_current_width</span><span class="p">,</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_current_height</span><span class="p">,</span>
                    <span class="s2">&quot;is_maximized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_is_maximized</span><span class="p">,</span>
                    <span class="s2">&quot;stacks_state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_stacks_state</span>
                <span class="p">},</span> <span class="n">state_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainApplication._load_window_state"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication._load_window_state">[docs]</a>    <span class="k">def</span> <span class="nf">_load_window_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load window state from file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_width</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_height</span><span class="p">,</span>
            <span class="s2">&quot;is_maximized&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;stacks_state&quot;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_state_cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">GLib</span><span class="o">.</span><span class="n">get_user_cache_dir</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_id</span><span class="p">,</span> <span class="s2">&quot;state.json&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win_state_cache_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win_state_cache_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">state_file</span><span class="p">:</span>
                    <span class="n">state_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">state_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="n">state_data</span> <span class="o">=</span> <span class="n">default_state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_data</span> <span class="o">=</span> <span class="n">default_state</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">win_current_width</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="n">default_state</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_current_height</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="n">default_state</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_is_maximized</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_maximized&quot;</span><span class="p">,</span> <span class="n">default_state</span><span class="p">[</span><span class="s2">&quot;is_maximized&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_stacks_state</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stacks_state&quot;</span><span class="p">,</span> <span class="n">default_state</span><span class="p">[</span><span class="s2">&quot;stacks_state&quot;</span><span class="p">])</span>

        <span class="n">use_header_bars_on_dialogs</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_header_bars_on_dialogs&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">set_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">,</span> <span class="n">use_header_bars_on_dialogs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_action_state</span><span class="p">(</span><span class="s2">&quot;use_header_bars_on_dialogs&quot;</span><span class="p">,</span>
                                 <span class="n">GLib</span><span class="o">.</span><span class="n">Variant</span><span class="o">.</span><span class="n">new_boolean</span><span class="p">(</span><span class="n">use_header_bars_on_dialogs</span><span class="p">))</span></div>

<div class="viewcode-block" id="MainApplication.create_menu_item"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.create_menu_item">[docs]</a>    <span class="k">def</span> <span class="nf">create_menu_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create menu item.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            Text for the menu item.</span>
<span class="sd">        callback : method</span>
<span class="sd">            Callback function to be executed when the menu item is activated.</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Gtk.MenuItem</span>
<span class="sd">            The created menu item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">MenuItem</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;activate&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item</span></div>

<div class="viewcode-block" id="MainApplication.set_instance"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.set_instance">[docs]</a>    <span class="k">def</span> <span class="nf">set_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instance_info : dict</span>
<span class="sd">            Xlet instance information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">set_visible_child_name</span><span class="p">(</span><span class="n">instance_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_bar</span><span class="o">.</span><span class="n">instance_switcher</span><span class="o">.</span><span class="n">set_stack</span><span class="p">(</span><span class="n">instance_info</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">])</span>

        <span class="c1"># NOTE: This has to be done BEFORE storing the new instance because it has to remove the</span>
        <span class="c1"># highlighting of the currently highlighted xlet, highlight the one that&#39;s going to be</span>
        <span class="c1"># the selected instance and then set the selected instance.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_type</span> <span class="o">!=</span> <span class="s2">&quot;extension&quot;</span> <span class="ow">and</span> <span class="n">proxy</span><span class="p">:</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">highlightXlet</span><span class="p">(</span><span class="s2">&quot;(ssb)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">highlightXlet</span><span class="p">(</span><span class="s2">&quot;(ssb)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">,</span> <span class="n">instance_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span> <span class="o">=</span> <span class="n">instance_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_win_subtitle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible_stack_for_page</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.set_visible_stack_for_page"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.set_visible_stack_for_page">[docs]</a>    <span class="k">def</span> <span class="nf">set_visible_stack_for_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set visible stack for page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_stacks_state</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_stack</span><span class="p">:</span>
            <span class="n">instance_stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">get_visible_child</span><span class="p">()</span>
            <span class="n">page_stack</span> <span class="o">=</span> <span class="n">instance_stack</span><span class="o">.</span><span class="n">get_page_stack</span><span class="p">()</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">page_stack</span><span class="o">.</span><span class="n">get_child_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_stack</span> <span class="k">if</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_stack</span> <span class="k">else</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;stack_id&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">page_stack</span><span class="o">.</span><span class="n">set_visible_child</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">win_initial_stack</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="MainApplication.previous_instance"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.previous_instance">[docs]</a>    <span class="k">def</span> <span class="nf">previous_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select previous instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">set_transition_type</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">StackTransitionType</span><span class="o">.</span><span class="n">SLIDE_RIGHT</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainApplication.next_instance"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.next_instance">[docs]</a>    <span class="k">def</span> <span class="nf">next_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select next instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_stack</span><span class="o">.</span><span class="n">set_transition_type</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">StackTransitionType</span><span class="o">.</span><span class="n">SLIDE_LEFT</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_instances_info</span><span class="p">[</span><span class="n">index</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainApplication.open_help_page"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.open_help_page">[docs]</a>    <span class="k">def</span> <span class="nf">open_help_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the xlet help page.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">run</span><span class="p">([</span><span class="s2">&quot;xdg-open&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_file_path</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainApplication.backup_settings"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.backup_settings">[docs]</a>    <span class="k">def</span> <span class="nf">backup_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Backup xlet settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Select or enter file to export to&quot;</span><span class="p">),</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SAVE</span><span class="p">,</span>
            <span class="n">transient_for</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
            <span class="n">use_header_bar</span><span class="o">=</span><span class="n">get_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">),</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;_Cancel&quot;</span><span class="p">),</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span>
                     <span class="n">_</span><span class="p">(</span><span class="s2">&quot;_Save&quot;</span><span class="p">),</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">ACCEPT</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">set_do_overwrite_confirmation</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">filter_text</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileFilter</span><span class="p">()</span>
        <span class="n">filter_text</span><span class="o">.</span><span class="n">add_pattern</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">)</span>
        <span class="n">filter_text</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;JSON files&quot;</span><span class="p">))</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">filter_text</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">ACCEPT</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;.json&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.json&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.import_settings"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.import_settings">[docs]</a>    <span class="k">def</span> <span class="nf">import_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import xlet settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Select a JSON file to import&quot;</span><span class="p">),</span>
            <span class="n">action</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
            <span class="n">transient_for</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
            <span class="n">use_header_bar</span><span class="o">=</span><span class="n">get_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">),</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;_Cancel&quot;</span><span class="p">),</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span>
                     <span class="n">_</span><span class="p">(</span><span class="s2">&quot;_Save&quot;</span><span class="p">),</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">filter_text</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileFilter</span><span class="p">()</span>
        <span class="n">filter_text</span><span class="o">.</span><span class="n">add_pattern</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">)</span>
        <span class="n">filter_text</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;JSON files&quot;</span><span class="p">))</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">filter_text</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_filename</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.reset_settings"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.reset_settings">[docs]</a>    <span class="k">def</span> <span class="nf">reset_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset xlet settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
            <span class="n">transient_for</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span>
            <span class="n">use_header_bar</span><span class="o">=</span><span class="n">get_global</span><span class="p">(</span><span class="s2">&quot;USE_HEADER_BARS_ON_DIALOGS&quot;</span><span class="p">),</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">DialogFlags</span><span class="o">.</span><span class="n">MODAL</span> <span class="o">|</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">DialogFlags</span><span class="o">.</span><span class="n">DESTROY_WITH_PARENT</span><span class="p">,</span>
            <span class="n">message_type</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageType</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ButtonsType</span><span class="o">.</span><span class="n">YES_NO</span>
        <span class="p">)</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Trying to reset all settings!!!&quot;</span><span class="p">))</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Reset all settings to their default values?&quot;</span><span class="p">))</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">set_markup</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">YES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_to_defaults</span><span class="p">()</span>

        <span class="n">dialog</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.on_quit"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.on_quit">[docs]</a>    <span class="k">def</span> <span class="nf">on_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On quit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_store_window_state</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proxy</span><span class="o">.</span><span class="n">highlightXlet</span><span class="p">(</span><span class="s2">&quot;(ssb)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_uuid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_instance</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtk_icon_theme_signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtk_app_info_monitor_signal</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainApplication.notify_errors"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.MainApplication.notify_errors">[docs]</a>    <span class="k">def</span> <span class="nf">notify_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a desktop notification when non-critical errors are found.</span>

<span class="sd">        NOTE</span>
<span class="sd">        ----</span>
<span class="sd">        The use of ``Notify`` and :any:`Gio.Notification` as a fallback is because</span>
<span class="sd">        :any:`Gio.Notification`&#39;s notifications are tied to the :any:`Gtk.Application`</span>
<span class="sd">        that sends them (¬¬). If a fatal error occurs after a non-critical, I&#39;m left looking</span>
<span class="sd">        at the screen like a moron waiting for the application window to appear. Using</span>
<span class="sd">        ``Notify``, I&#39;m informed instantly.</span>
<span class="sd">        If (when) ``Notify`` is removed, implement a call to ``notify-send`` and f**k Gtk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_application_title</span><span class="p">()</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;Errors found while creating widgets. You know what to do.&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;Notify&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Notify</span>

            <span class="n">Notify</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application_id</span><span class="p">)</span>
            <span class="n">notification</span> <span class="o">=</span> <span class="n">Notify</span><span class="o">.</span><span class="n">Notification</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s2">&quot;dialog-error&quot;</span><span class="p">)</span>
            <span class="n">notification</span><span class="o">.</span><span class="n">set_urgency</span><span class="p">(</span><span class="n">Notify</span><span class="o">.</span><span class="n">Urgency</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
            <span class="n">notification</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gi.repository.Notify used.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">notification</span> <span class="o">=</span> <span class="n">Gio</span><span class="o">.</span><span class="n">Notification</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">notification</span><span class="o">.</span><span class="n">set_icon</span><span class="p">(</span><span class="n">Gio</span><span class="o">.</span><span class="n">ThemedIcon</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;dialog-error&quot;</span><span class="p">))</span>
            <span class="n">notification</span><span class="o">.</span><span class="n">set_body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
            <span class="n">notification</span><span class="o">.</span><span class="n">set_priority</span><span class="p">(</span><span class="n">Gio</span><span class="o">.</span><span class="n">NotificationPriority</span><span class="o">.</span><span class="n">URGENT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_notification</span><span class="p">(</span><span class="s2">&quot;send-message&quot;</span><span class="p">,</span> <span class="n">notification</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gi.repository.Gio.Notification used.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli"><a class="viewcode-back" href="../modules/xlets_settings/xlets_settings.html#xlets_settings.cli">[docs]</a><span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="n">window_definition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CLI interface.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window_definition : WindowDefinition</span>
<span class="sd">        The instance of :any:`WindowDefinition` containing the data to generate all window widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--xlet-type&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;xlet_type&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;extension&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--xlet-instance-id&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;xlet_instance_id&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--xlet-uuid&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;xlet_uuid&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--app-id&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;application_id&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--stack-id&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;win_initial_stack&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1"># NOTE: I exposed the following arguments mostly for when this framework is used in a</span>
    <span class="c1"># &quot;non-standard way&quot;. Since I don&#39;t have in mind any non-standard implementations,</span>
    <span class="c1"># I don&#39;t use the arguments, but I will keep them all the same.</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--app-title&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;application_title&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--win-width&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;win_initial_width&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--win-height&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;win_initial_height&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;debug_mode&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--hide-settings-handling&quot;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;display_settings_handling&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span>
        <span class="s2">&quot;window_definition&quot;</span><span class="p">:</span> <span class="n">window_definition</span>
    <span class="p">})</span>

    <span class="k">global</span> <span class="n">MAIN_APP</span>
    <span class="n">MAIN_APP</span> <span class="o">=</span> <span class="n">MainApplication</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">set_global</span><span class="p">(</span><span class="s2">&quot;MAIN_APP&quot;</span><span class="p">,</span> <span class="n">MAIN_APP</span><span class="p">)</span>
    <span class="n">MAIN_APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Odyseus..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://gitlab.com/Odyseus/sphinx_rtd_theme_mod">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>

        </div>
      </div>

      <a id="to-top-of-page" href="#top">
        <i class="fa fa-chevron-circle-up"></i>
      </a>

    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>