<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>xlets_settings.KeybindingWidgets &mdash; Cinnamon Tools  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/cinnamon-logo.svg"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: False" >
            <a href="../../index.html" class="icon icon-home"> Cinnamon Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../includes/00-requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/01-usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/02-tips-and-tricks.html">Cinnamon tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/03-development-notes.html">Development notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/04-code-styling.html">Code styling/guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/05-EOL.html"><abbr title="end-of-life">EOL</abbr> ideas/plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../includes/06-xlets-settings-custom-framework.html">Xlets settings custom framework</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: False" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cinnamon Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
          <li><a href="../xlets_settings.html">xlets_settings</a> &raquo;</li>
      <li>xlets_settings.KeybindingWidgets</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for xlets_settings.KeybindingWidgets</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Keybinding widgets.</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">FORBIDDEN_KEYVALS : list</span>
<span class="sd">    Forbidden key values.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">gettext</span>
<span class="kn">import</span> <span class="nn">gi</span>

<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;Gdk&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s2">&quot;Gtk&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">GObject</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gdk</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gtk</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">display_message_dialog</span>
<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="n">get_keybinding_display_name</span>

<span class="c1"># NOTE: All translatable strings used in this module are available in Cinnamon.</span>
<span class="c1"># Keep it that way.</span>
<span class="n">gettext</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="s2">&quot;cinnamon&quot;</span><span class="p">,</span> <span class="s2">&quot;/usr/share/locale&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">gettext</span><span class="o">.</span><span class="n">gettext</span>

<span class="n">FORBIDDEN_KEYVALS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Home</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Left</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Up</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Right</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Down</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Page_Up</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Page_Down</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_End</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Tab</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Return</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_space</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Mode_switch</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_0</span><span class="p">,</span>  <span class="c1"># numerics currently are recogized only as _End, _Down, etc.. with or without numlock</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_1</span><span class="p">,</span>  <span class="c1"># Gdk checks numlock and parses out the correct key, but this could change, so list</span>
    <span class="c1"># these numerics anyhow. (This may differ depending on kb layouts, locales, etc.. but</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_2</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_3</span><span class="p">,</span>  <span class="c1"># I didn&#39;t thoroughly check.)</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_4</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_5</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_6</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_7</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_8</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_9</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_End</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Down</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Next</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Left</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Begin</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Right</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Home</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Up</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Prior</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Insert</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Delete</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Add</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Subtract</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Multiply</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Divide</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Enter</span><span class="p">,</span>
    <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Num_Lock</span>
<span class="p">]</span>


<div class="viewcode-block" id="ButtonKeybinding"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding">[docs]</a><span class="k">class</span> <span class="nc">ButtonKeybinding</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">TreeView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Button keybinding.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    accel_string : str</span>
<span class="sd">        The widget value.</span>
<span class="sd">    entry_store : Gtk.ListStore</span>
<span class="sd">        The ``Gtk.ListStore`` for ``self``.</span>
<span class="sd">    keybinding_cell : CellRendererKeybinding</span>
<span class="sd">        The widget that will display the stored keybinding.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__gsignals__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accel-edited&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">GObject</span><span class="o">.</span><span class="n">SignalFlags</span><span class="o">.</span><span class="n">RUN_LAST</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span>
        <span class="s2">&quot;accel-cleared&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">GObject</span><span class="o">.</span><span class="n">SignalFlags</span><span class="o">.</span><span class="n">RUN_LAST</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">())</span>
    <span class="p">}</span>

    <span class="n">__gproperties__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span>
                         <span class="s2">&quot;accelerator string&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Parseable accelerator string&quot;</span><span class="p">,</span>
                         <span class="kc">None</span><span class="p">,</span>
                         <span class="n">GObject</span><span class="o">.</span><span class="n">ParamFlags</span><span class="o">.</span><span class="n">READWRITE</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_headers_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_enable_search</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_hover_selection</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_tooltip_text</span><span class="p">(</span><span class="n">CellRendererKeybinding</span><span class="o">.</span><span class="n">TOOLTIP_TEXT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span> <span class="o">=</span> <span class="n">CellRendererKeybinding</span><span class="p">(</span><span class="n">a_widget</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;accel-edited&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_cell_edited</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;accel-cleared&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_cell_cleared</span><span class="p">)</span>

        <span class="n">col</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">TreeViewColumn</span><span class="p">(</span><span class="s2">&quot;binding&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="p">,</span> <span class="n">accel_string</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">col</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">append_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;editable&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;focus-out-event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_focus_lost</span><span class="p">)</span>

<div class="viewcode-block" id="ButtonKeybinding.on_cell_edited"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.on_cell_edited">[docs]</a>    <span class="k">def</span> <span class="nf">on_cell_edited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">accel_string</span><span class="p">,</span> <span class="n">accel_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On cell edited.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cell : CellRendererKeybinding</span>
<span class="sd">            The object which received the signal.</span>
<span class="sd">        path : Gtk.TreePath</span>
<span class="sd">            String representation of :py:class:`Gtk.TreePath` describing the event location.</span>
<span class="sd">        accel_string : str</span>
<span class="sd">            The widget value.</span>
<span class="sd">        accel_label : str</span>
<span class="sd">            The widget display value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="n">accel_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;accel-edited&quot;</span><span class="p">,</span> <span class="n">accel_string</span><span class="p">,</span> <span class="n">accel_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span></div>

<div class="viewcode-block" id="ButtonKeybinding.on_cell_cleared"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.on_cell_cleared">[docs]</a>    <span class="k">def</span> <span class="nf">on_cell_cleared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On cell cleared.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cell : CellRendererKeybinding</span>
<span class="sd">            The object which received the signal.</span>
<span class="sd">        path : Gtk.TreePath</span>
<span class="sd">            String representation of :py:class:`Gtk.TreePath` describing the event location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;accel-cleared&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span></div>

<div class="viewcode-block" id="ButtonKeybinding.on_focus_lost"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.on_focus_lost">[docs]</a>    <span class="k">def</span> <span class="nf">on_focus_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On focus lost-</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        widget : ButtonKeybinding</span>
<span class="sd">            The object which received the signal.</span>
<span class="sd">        event : Gdk.EventFocus</span>
<span class="sd">            The ``Gdk.EventFocus`` which triggered this signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_selection</span><span class="p">()</span><span class="o">.</span><span class="n">unselect_all</span><span class="p">()</span></div>

<div class="viewcode-block" id="ButtonKeybinding.load_model"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.load_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ListStore</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>  <span class="c1"># Accel string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_store</span><span class="p">)</span></div>

<div class="viewcode-block" id="ButtonKeybinding.do_get_property"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.do_get_property">[docs]</a>    <span class="k">def</span> <span class="nf">do_get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get property override.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The property to handle.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The accel. string.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Wrong attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown property </span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ButtonKeybinding.do_set_property"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.do_set_property">[docs]</a>    <span class="k">def</span> <span class="nf">do_set_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set property override.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The property to handle.</span>
<span class="sd">        value : str</span>
<span class="sd">            The property value.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Wrong attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keybinding_cell</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown property </span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ButtonKeybinding.get_accel_string"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.get_accel_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_accel_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get accel. string.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The accel. string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span></div>

<div class="viewcode-block" id="ButtonKeybinding.set_accel_string"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.ButtonKeybinding.set_accel_string">[docs]</a>    <span class="k">def</span> <span class="nf">set_accel_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accel_string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set accel. string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        accel_string : str</span>
<span class="sd">            The accel. string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="n">accel_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span></div></div>


<span class="n">GObject</span><span class="o">.</span><span class="n">type_register</span><span class="p">(</span><span class="n">ButtonKeybinding</span><span class="p">)</span>


<div class="viewcode-block" id="CellRendererKeybinding"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding">[docs]</a><span class="k">class</span> <span class="nc">CellRendererKeybinding</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">CellRendererText</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cell renderer keybinding.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    a_widget : ButtonKeybinding</span>
<span class="sd">        This widget container.</span>
<span class="sd">    accel_editable : Gtk.CellEditable</span>
<span class="sd">        The ``Gtk.CellEditable`` for the widget.</span>
<span class="sd">    accel_string : str</span>
<span class="sd">        The accel. string.</span>
<span class="sd">    focus_id : int</span>
<span class="sd">        Storage for the ``focus-out-event`` signal connection.</span>
<span class="sd">    keyboard : Gdk.InputSource</span>
<span class="sd">        The device from which to grab events.</span>
<span class="sd">    path : Gtk.TreePath</span>
<span class="sd">        String representation of :py:class:`Gtk.TreePath` describing the event location.</span>
<span class="sd">    press_event : Gdk.Event</span>
<span class="sd">        Press event storage.</span>
<span class="sd">    press_event_id : int</span>
<span class="sd">        Storage for the ``key-press-event`` signal connection.</span>
<span class="sd">    release_event_id : int</span>
<span class="sd">        Storage for the ``key-release-event`` signal connection.</span>
<span class="sd">    teaching : bool</span>
<span class="sd">        *Flag* used to know when this widget is in *keyboard capture mode*.</span>
<span class="sd">    TOOLTIP_TEXT : str</span>
<span class="sd">        Tooltip text for the button that will contain this widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__gsignals__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accel-edited&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">GObject</span><span class="o">.</span><span class="n">SignalFlags</span><span class="o">.</span><span class="n">RUN_LAST</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span>
        <span class="s2">&quot;accel-cleared&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">GObject</span><span class="o">.</span><span class="n">SignalFlags</span><span class="o">.</span><span class="n">RUN_LAST</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,))</span>
    <span class="p">}</span>

    <span class="n">__gproperties__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span>
                         <span class="s2">&quot;accelerator string&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Parseable accelerator string&quot;</span><span class="p">,</span>
                         <span class="kc">None</span><span class="p">,</span>
                         <span class="n">GObject</span><span class="o">.</span><span class="n">ParamFlags</span><span class="o">.</span><span class="n">READWRITE</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">TOOLTIP_TEXT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Click to set a new accelerator key.&quot;</span><span class="p">),</span>
                                   <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Press Escape or click again to cancel the operation.&quot;</span><span class="p">),</span>
                                   <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Press Backspace to clear the existing keybinding.&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_widget</span><span class="p">,</span> <span class="n">accel_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a_widget : ButtonKeybinding</span>
<span class="sd">            This widget container.</span>
<span class="sd">        accel_string : None, optional</span>
<span class="sd">            The accel. string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;editing-started&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editing_started</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release_event_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">press_event_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a_widget</span> <span class="o">=</span> <span class="n">a_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="n">accel_string</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_label</span><span class="p">()</span>

<div class="viewcode-block" id="CellRendererKeybinding.do_get_property"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.do_get_property">[docs]</a>    <span class="k">def</span> <span class="nf">do_get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get property override.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The property to handle.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The accel. string.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Wrong attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown property </span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.do_set_property"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.do_set_property">[docs]</a>    <span class="k">def</span> <span class="nf">do_set_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set property override.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str</span>
<span class="sd">            The property to handle.</span>
<span class="sd">        value : str</span>
<span class="sd">            The property value.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            Wrong attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;accel-string&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_label</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown property </span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.update_label"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.update_label">[docs]</a>    <span class="k">def</span> <span class="nf">update_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update widget label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;unassigned&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">get_keybinding_display_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accel_string</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.set_value"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accel_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set widget value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        accel_string : None, optional</span>
<span class="sd">            The accel. string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s2">&quot;accel-string&quot;</span><span class="p">,</span> <span class="n">accel_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.editing_started"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.editing_started">[docs]</a>    <span class="k">def</span> <span class="nf">editing_started</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">editable</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cell editing started.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        renderer : CellRendererKeybinding</span>
<span class="sd">            The object which received the signal.</span>
<span class="sd">        editable : Gtk.CellEditable</span>
<span class="sd">            The ``Gtk.CellEditable``.</span>
<span class="sd">        path : str</span>
<span class="sd">            The path identifying the edited cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">get_current_event_device</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">get_source</span><span class="p">()</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">InputSource</span><span class="o">.</span><span class="n">KEYBOARD</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">=</span> <span class="n">device</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get_associated_device</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">grab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_widget</span><span class="o">.</span><span class="n">get_window</span><span class="p">(),</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">GrabOwnership</span><span class="o">.</span><span class="n">WINDOW</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="n">Gdk</span><span class="o">.</span><span class="n">EventMask</span><span class="o">.</span><span class="n">KEY_PRESS_MASK</span> <span class="o">|</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EventMask</span><span class="o">.</span><span class="n">KEY_RELEASE_MASK</span><span class="p">,</span>
                               <span class="kc">None</span><span class="p">,</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">CURRENT_TIME</span><span class="p">)</span>

            <span class="n">editable</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Pick an accelerator&quot;</span><span class="p">))</span>
            <span class="c1"># NOTE: Set to expand horizontally because in certain versions of GTK</span>
            <span class="c1"># the unbelievable idiotic editable Gtk.Entry inside the Gtk.CellRendererText</span>
            <span class="c1"># can&#39;t decide where the frak to place itself! ¬¬</span>
            <span class="c1"># So, expand it so the freaking text can be seen!!!!!!!</span>
            <span class="n">editable</span><span class="o">.</span><span class="n">set_hexpand</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span> <span class="o">=</span> <span class="n">editable</span>

            <span class="c1"># Mark for deletion on EOL. Gtk4</span>
            <span class="c1"># Use Gtk.EventControllerKey instead of key-press-event and key-release-event.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">release_event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="s2">&quot;key-release-event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_release</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">press_event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;key-press-event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_press</span><span class="p">)</span>
            <span class="c1"># Mark for deletion on EOL. Gtk4</span>
            <span class="c1"># Use Gtk.EventControllerFocus instead of focus-out-event.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;focus-out-event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_focus_out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ungrab</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_label</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.on_focus_out"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.on_focus_out">[docs]</a>    <span class="k">def</span> <span class="nf">on_focus_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On focus out callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            Arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ungrab</span><span class="p">()</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.on_key_press"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.on_key_press">[docs]</a>    <span class="k">def</span> <span class="nf">on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On key press callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        widget : Gtk.CellEditable</span>
<span class="sd">            The ``Gtk.CellEditable`` for the widget.</span>
<span class="sd">        event : Gdk.EventKey</span>
<span class="sd">            The ``Gdk.EventKey`` which triggered this signal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether to propagate the event or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span>

        <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_PROPAGATE</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.on_key_release"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.on_key_release">[docs]</a>    <span class="k">def</span> <span class="nf">on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On key release callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        widget : Gtk.CellEditable</span>
<span class="sd">            The ``Gtk.CellEditable`` for the widget.</span>
<span class="sd">        event : Gdk.EventKey</span>
<span class="sd">            The ``Gdk.EventKey`` which triggered this signal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether to propagate the event or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ungrab</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="ow">or</span> <span class="n">event</span>

        <span class="n">display</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">get_display</span><span class="p">()</span>

        <span class="n">keyval</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">group</span>
        <span class="n">accel_mods</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">state</span>

        <span class="c1"># HACK: we don&#39;t want to use SysRq as a keybinding (but we do</span>
        <span class="c1"># want Alt+Print), so we avoid translation from Alt+Print to SysRq</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">keyval</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Sys_Req</span> <span class="ow">and</span> \
           <span class="p">((</span><span class="n">accel_mods</span> <span class="o">&amp;</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">ModifierType</span><span class="o">.</span><span class="n">MOD1_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">keyval</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Print</span>
            <span class="n">consumed_modifiers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keymap</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">Keymap</span><span class="o">.</span><span class="n">get_for_display</span><span class="p">(</span><span class="n">display</span><span class="p">)</span>
            <span class="n">shift_group_mask</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">shift_group_mask</span> <span class="o">=</span> <span class="n">keymap</span><span class="o">.</span><span class="n">get_modifier_mask</span><span class="p">(</span><span class="n">Gdk</span><span class="o">.</span><span class="n">ModifierIntent</span><span class="o">.</span><span class="n">SHIFT_GROUP</span><span class="p">)</span>

            <span class="n">retval</span><span class="p">,</span> <span class="n">keyval</span><span class="p">,</span> <span class="n">effective_group</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">consumed_modifiers</span> <span class="o">=</span> \
                <span class="n">keymap</span><span class="o">.</span><span class="n">translate_keyboard_state</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">hardware_keycode</span><span class="p">,</span> <span class="n">accel_mods</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">consumed_modifiers</span><span class="p">:</span>
                <span class="n">consumed_modifiers</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">shift_group_mask</span>

        <span class="n">accel_key</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">keyval_to_lower</span><span class="p">(</span><span class="n">keyval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_ISO_Left_Tab</span><span class="p">:</span>
            <span class="n">accel_key</span> <span class="o">=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Tab</span>

        <span class="n">accel_mods</span> <span class="o">&amp;=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">accelerator_get_default_mod_mask</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">accel_mods</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Escape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_label</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span>
            <span class="k">elif</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_BackSpace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">teaching</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;accel-cleared&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span>
            <span class="k">elif</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Return</span> <span class="ow">or</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_KP_Enter</span> <span class="ow">or</span> <span class="n">accel_key</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_space</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span>

        <span class="n">accel_string</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">accelerator_name_with_keycode</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">accel_key</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">hardware_keycode</span><span class="p">,</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">ModifierType</span><span class="p">(</span><span class="n">accel_mods</span><span class="p">))</span>
        <span class="n">accel_label</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">accelerator_get_label_with_keycode</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">accel_key</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">hardware_keycode</span><span class="p">,</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">ModifierType</span><span class="p">(</span><span class="n">accel_mods</span><span class="p">))</span>

        <span class="c1"># print(&quot;accel_mods: %d, keyval: %d, Storing %s as %s&quot; % (accel_mods, keyval, accel_label, accel_string))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">accel_mods</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">accel_mods</span> <span class="o">==</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">ModifierType</span><span class="o">.</span><span class="n">SHIFT_MASK</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">hardware_keycode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_a</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_z</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_A</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Z</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_0</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_9</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_kana_fullstop</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_semivoicedsound</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Arabic_comma</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Arabic_sukun</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Serbian_dje</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Cyrillic_HARDSIGN</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Greek_ALPHAaccent</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Greek_omega</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_hebrew_doublelowline</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_hebrew_taf</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Thai_kokai</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Thai_lekkao</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Hangul</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Hangul_Special</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">keyval</span> <span class="o">&gt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Hangul_Kiyeog</span> <span class="ow">and</span> <span class="n">keyval</span> <span class="o">&lt;=</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">KEY_Hangul_J_YeorinHieuh</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">keyval</span> <span class="ow">in</span> <span class="n">FORBIDDEN_KEYVALS</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This key combination, </span><span class="se">\&#39;</span><span class="s2">&lt;b&gt;</span><span class="si">%s</span><span class="s2">&lt;/b&gt;</span><span class="se">\&#39;</span><span class="s2"> cannot be used because it would become impossible to type using this key.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Please try again with a modifier key such as Control, Alt or Super (Windows key) at the same time.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">display_message_dialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_widget</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">press_event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">accel_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;accel-edited&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">accel_string</span><span class="p">,</span> <span class="n">accel_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">Gdk</span><span class="o">.</span><span class="n">EVENT_STOP</span></div>

<div class="viewcode-block" id="CellRendererKeybinding.ungrab"><a class="viewcode-back" href="../../modules/xlets_settings/xlets_settings.KeybindingWidgets.html#xlets_settings.KeybindingWidgets.CellRendererKeybinding.ungrab">[docs]</a>    <span class="k">def</span> <span class="nf">ungrab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clean up events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">ungrab</span><span class="p">(</span><span class="n">Gdk</span><span class="o">.</span><span class="n">CURRENT_TIME</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_event_id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release_event_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">release_event_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">press_event_id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">press_event_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">press_event_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">editing_done</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel_editable</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div></div>


<span class="n">GObject</span><span class="o">.</span><span class="n">type_register</span><span class="p">(</span><span class="n">CellRendererKeybinding</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Odyseus..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>

        </div>
      </div>

      <a id="to-top-of-page" href="#top">
        <i class="fa fa-chevron-circle-up"></i>
      </a>

    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>